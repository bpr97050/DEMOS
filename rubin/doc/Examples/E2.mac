/*
 * –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–ª–æ–∂–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞–∫—Ä–æ
 *
 * –í–µ–¥–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
 * –ò–º–µ–µ—Ç—Å—è –æ–¥–Ω–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ "—Ä–∞–±–æ—Ç–Ω–∏–∫", –≤ –∫–æ—Ç–æ—Ä–æ–º
 * —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–æ–º–µ—Ä, —Ñ–∞–º–∏–ª–∏—è –∏ –∏–Ω–∏—Ü–∏–∞–ª—ã, –∑–∞—Ä–ø–ª–∞—Ç–∞, –≥–æ–¥—ã —Ä–æ–∂–¥–µ–Ω–∏—è
 * –∏ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã, –Ω–æ–º–µ—Ä –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞
 *
 * –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–µ–¥–µ–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤ –∏–º–µ–µ—Ç—Å—è –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –º–∞–∫—Å_–Ω–æ–º–µ—Ä–∞,
 * –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –ø–æ–ª–µ "—Ä–∞–±–æ—Ç–Ω–∏–∫" - —Ç–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –Ω–æ–≤–æ–≥–æ
 * —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ (–æ–Ω —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç).
 * –≠—Ç–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ –∫–æ—Ä—Ç–µ–∂–∞ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º "tid"
 * (–∞–¥—Ä–µ—Å –≤ —Ñ–∞–π–ª–µ), —Ä–∞–≤–Ω—ã–º 0
 *
 * –î–ª—è —ç–∫—Ä–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Ä–æ:
 * {CLR} - —á–∏—Å—Ç–∫–∞ —ç–∫—Ä–∞–Ω–∞
 * {s0}, {s1}, {s2}, {s3} - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
 * (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ç–∏ —Å–∏–º–≤–æ–ª—ã –ø—Ä–∏ –≤—ã–¥–∞—á–µ –Ω–∞ —ç–∫—Ä–∞–Ω –∑–∞–Ω–∏–º–∞—é—Ç 1 –ø–æ–∑–∏—Ü–∏—é
 * –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç—É–¥–∞ –ø—Ä–æ–±–µ–ª
 * {CS1} - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —ç–∫—Ä–∞–Ω–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–∏ 5-24, –µ—Å–ª–∏ —ç—Ç–æ
 * –≤–æ–æ–±—â–µ –≤–æ–∑–º–æ–∂–Ω–æ
 *    –ö –û –ú –ú –ï –ù –¢ –ê –† –ò –ò    –ö   –ü –† –ò –ú –ï –† –£
 *
 * 1. –õ—É—á—à–µ–º —Å—Ç–∏–ª–µ–º –±—ã–ª–æ –±—ã –≤—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ –æ–ø–∏—Å–∞–Ω–∏—è –º–∞–∫—Ä–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π
 *    —Ñ–∞–π–ª –∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –µ–≥–æ –ø–æ –∫–æ–º–∞–Ω–¥–µ "\ i –∏–º—è" (–±–µ–∑ –ø—Ä–æ–±–µ–ª–∞ –º–µ–∂–¥—É \ –∏ i).
 *    –ü—Ä–∏ —ç—Ç–æ–º –ø–æ–∏—Å–∫ –º–µ—Ç–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –±—É–¥–µ—Ç –∏–¥—Ç–∏ –±—ã—Å—Ç—Ä–µ–µ
 * 2. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã
 *    –º–æ–Ω–∏—Ç–æ—Ä–∞ –∏ –º–∞–∫—Ä–æ - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏—Ö –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç
 */
{define;{CLR};[H[J}
{define;{CS1};[5;24r}
{define;{s0};[p}
{define;{s1};[16p}
{define;{s2};[17p}
{define;{s3};[19p}
{remove;{continuetrap}}
{remove;–Ω–æ–≤}
/*
 * –ú–∞–∫—Ä–æ –Ω–æ–≤ —Å–ª—É–∂–∏—Ç –¥–ª—è –≤–≤–µ–¥–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–ª—É–∂–∞—â–µ–≥–æ
 */
{define; –Ω–æ–≤; \
/*\
{type @{CLR}} {type  @{s2}–í–≤–æ–¥–∏–º –Ω–æ–≤–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞{s0} } {type }\
 {define;{—Ñ–∞–º};@{read @{s2}–§–∞–º–∏–ª–∏—è –ò.–û.?       {s1} .................... {s0}}}\
 {define;{–Ω–∞—á};@{read @{s2}–ù–∞—á–∞–ª—å–Ω–∏–∫(–§–∞–º–∏–ª–∏—è)? {s1} .................... {s0}}}\
{define;{–≥–æ–¥—Ä};@{read @{s2}–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è?       {s1} .... {s0}}}\
{define;{–≥–æ–¥–Ω};@{read @{s2}–ì–æ–¥ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã?  {s1} .... {s0}}}\
 {define;{–∑–∞—Ä};@{read @{s2}–ó–∞—Ä–ø–ª–∞—Ç–∞?           {s1} .... {s0}}}\
 */{type }\
{type  @{s2}{—Ñ–∞–º} –Ω–∞—á–∞–ª—å–Ω–∏–∫= {–Ω–∞—á} —Ä–æ–¥. {–≥–æ–¥—Ä} –Ω–∞—á–∞–ª {–≥–æ–¥–Ω} —Å—Ç–∞–≤–∫–∞ {–∑–∞—Ä}{s0}}\
{define;{ask}; @{read –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–¥–∞/–Ω–µ—Ç)?}}\
{ifsame;@{ask};–¥–∞;{type –ó–∞–Ω–æ—Å–∏–º!};/* {type –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ}}\
range of n is –º–∞–∫—Å_–Ω–æ–º–µ—Ä–∞\
replace n(—Ä–∞–±–æ—Ç–Ω–∏–∫=n.—Ä–∞–±–æ—Ç–Ω–∏–∫+1) where (n.tid=0)\
range of r is —Ä–∞–±–æ—Ç–Ω–∏–∫\
append to —Ä–∞–±–æ—Ç–Ω–∏–∫ (–Ω–æ–º–µ—Ä=n.—Ä–∞–±–æ—Ç–Ω–∏–∫,\
		    –∏–º—è="{—Ñ–∞–º}",\
		    –Ω–∞—á–∞–ª—å–Ω–∏–∫=max(r.–Ω–æ–º–µ—Ä where r.–∏–º—è="{–Ω–∞—á} *"), \
		    —Ä–æ–¥–∏–ª—Å—è = {–≥–æ–¥—Ä},\
		    –Ω–∞—á–∞–ª_—Ä–∞–±–æ—Ç—É = {–≥–æ–¥–Ω},\
		    –∑–∞—Ä–∞–±–æ—Ç–æ–∫={–∑–∞—Ä} \
) where (n.tid=0)\
{ifsame;@{ask};–¥–∞;;*/}\
}
/*
 * –ú–∞–∫—Ä–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —É—Å–ª–æ–≤–∏–π –ø–æ–∏—Å–∫–∞/—É–¥–∞–ª–µ–Ω–∏—è
 */
{remove;—É—Å–ª}
{define;{where};1>0}
{define;–≤—ã–¥—É—Å–ª;\
{type  @{s2} –¢–µ–∫—É—â–µ–µ —É—Å–ª–æ–≤–∏–µ: {s0}} {type @{s1} {where}  {s0}}\
}
{define; —É—Å–ª; \
/*\
{type @{CLR}\\\
{s2}          –£—Å–ª–æ–≤–∏—è –ø–æ–∏—Å–∫–∞/–∏—Å–∫–ª—é—á–µ–Ω–∏—è. –í–≤–µ–¥–∏—Ç–µ    {s0}\\\
{s2}         –û–ø–µ—Ä–∞—Ü–∏—é {=/!=/>/</>=/<=} –Ω–∞ –º–µ—Å—Ç–µ "*",{s0}\\\
{s2}         –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –º–µ—Å—Ç–µ "."                  {s0}\\\
{s2}  –ò–ª–∏ <–í–ö>, –µ—Å–ª–∏ –ø–æ –¥–∞–Ω–Ω–æ–º—É –∫–ª—é—á—É —É—Å–ª–æ–≤–∏–π –Ω–µ—Ç   {s0} }\
{type }\
{define;{wh};}\
 {define;{—Ñ–∞–º};@{read @{s2}–§–∞–º–∏–ª–∏—è –ò.–û.?       {s1} ...................... {s0}}}\
	{ifgt;@{readcount};0;{define;{wh};@p.–∏–º—è = "{—Ñ–∞–º}" and};}\
 {define;{–Ω–∞—á};@{read @{s2}–ù–∞—á–∞–ª—å–Ω–∏–∫(–§–∞–º–∏–ª–∏—è)? {s1} ...................... {s0}}}\
	{ifgt;@{readcount};0;{define;{wh};@{wh} p.–Ω–∞—á–∞–ª—å–Ω–∏–∫=r.–Ω–æ–º–µ—Ä and r.–∏–º—è="{–Ω–∞—á}" and};}\
{define;{–≥–æ–¥—Ä};@{read @{s2}??–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è?       {s1} **.... {s0}}}\
	{ifgt;@{readcount};0;{define;{wh};@{wh} p.—Ä–æ–¥–∏–ª—Å—è {–≥–æ–¥—Ä} and};}\
{define;{–≥–æ–¥–Ω};@{read @{s2}??–ì–æ–¥ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã?  {s1} **.... {s0}}}\
	{ifgt;@{readcount};0;{define;{wh};@{wh} p.–Ω–∞—á–∞–ª_—Ä–∞–±–æ—Ç—É {–≥–æ–¥–Ω} and};}\
 {define;{–∑–∞—Ä};@{read @{s2}??–ó–∞—Ä–ø–ª–∞—Ç–∞?           {s1} **.... {s0}}}\
	{ifgt;@{readcount};0;{define;{wh};@{wh} p.–∑–∞—Ä–∞–±–æ—Ç–æ–∫ {–∑–∞—Ä} and};}\
{define;{wh};@{wh} 1>0}\
 */{type }\
{type  @{s2} –£—Å–ª–æ–≤–∏–µ –ø–æ–∏—Å–∫–∞: {s0}} {type @{s1} {wh}  {s0}}\
{define;{ask}; @{read –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–¥–∞/–Ω–µ—Ç)?}}\
{ifsame;@{ask};–¥–∞;{define;{where};@{wh}}{type –£—Å–ª–æ–≤–∏–µ –∑–∞–ø–æ–º–Ω–µ–Ω–æ};{type –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ}}\
}
\v\r
/*
 * –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
 *
 */
\branch start
/*
 * –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ - –ø–æ–¥–æ–∂–¥–µ–º, —á—Ç–æ–±—ã –Ω–µ –æ—á–∏—Å—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏
 */
\mark start1
{read –ù–∞–∂–º–∏—Ç–µ <–í–ö>, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å}
\v\r
\mark start
range of p is —Ä–∞–±–æ—Ç–Ω–∏–∫
range of r is —Ä–∞–±–æ—Ç–Ω–∏–∫
\g
{type @{CLR}{s2} –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –ö–ê–î–†–´ {s0}\
}
–≤—ã–¥—É—Å–ª
{type @{CS1}\
\
\
\
\
	{s2}            –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã          {s0}\
	{s2}       0  - –≤—ã–π—Ç–∏                          {s0}\
	{s2}       1  - –≤—ã–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é              {s0}\
	{s2}       2  - –∏—Å–∫–ª—é—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é           {s0}\
	{s2}       3  - –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é            {s0}\
	{s2}       4  - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Å–ª–æ–≤–∏—è             {s0}\
	{s2}       5  - –≤–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤      {s0}\
	{s2}       6  - —Å–±—Ä–æ—Å–∏—Ç—å —É—Å–ª–æ–≤–∏—è               {s0}\
	{s2}       7  - –≤—ã–≤–µ—Å—Ç–∏ –≤—Å—é —Ç–∞–±–ª–∏—Ü—É            {s0}\
}
\g
\r
{define;–æ—Ç–≤–µ—Ç;999}
{define;{–æ—Ç–≤–µ—Ç};@{read @{s2} –ù–æ–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã? {s1} .. {s0}}}
\g
\r
\branch ?{–æ—Ç–≤–µ—Ç}=0 exit
\branch ?{–æ—Ç–≤–µ—Ç}=1 retro
\branch ?{–æ—Ç–≤–µ—Ç}=2 del
\branch ?{–æ—Ç–≤–µ—Ç}=3 add
\branch ?{–æ—Ç–≤–µ—Ç}=4 set
\branch ?{–æ—Ç–≤–µ—Ç}=5 reads
\branch ?{–æ—Ç–≤–µ—Ç}=6 clr
\branch ?{–æ—Ç–≤–µ—Ç}=7 retall
\branch start
\mark set
—É—Å–ª
\g
\branch start1
\mark retro
retrieve (p.all) where ({where})
\g
\branch start1
\mark del
{type @{s1} –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, —Ç–æ –ª–∏ –≤—ã –∏—Å–∫–ª—é—á–∞–µ—Ç–µ {s0}}
retrieve (p.all) where ({where})
\g
\branch ?{ifsame;@{read –ò—Å–∫–ª—é—á–∞—Ç—å (–¥–∞/–Ω–µ—Ç)?};–¥–∞;0;1}=1 start
delete p where ({where})
\g
\branch start1
\mark add
–Ω–æ–≤
\g
{ifeq;@{tuplecount};1;;{type @{s3}–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –∑–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω{s0}}}
retrieve (r.all) where (r.–∏–º—è = "{—Ñ–∞–º}")
\g
\branch start1
\mark reads
/*
 * –í–≤–æ–¥ —Å–ª—É–∂–∞—â–∏—Ö –≤ —Ç–∞–±–ª–∏—á–Ω–æ–π —Ñ–æ—Ä–º–µ
 */
\r
{type @{CLR}{s2}–í–≤–æ–¥–∏–º –Ω–æ–≤–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞{s0}(–ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–æ–±–∏–≤–∞—Ç—å –ø—Ä–æ–±–µ–ª–∞–º–∏)}
	       {type @{s2}                     {s2}                    {s2}–≥–æ–¥ {s2}–Ω–∞—á {s2}–∑–∞—Ä  {s0}}
	       {type @{s2}  –§–∞–º–∏–ª–∏—è –ò.–û.       {s2}  –ù–∞—á–∞–ª—å–Ω–∏–∫(—Ñ–∞–º–∏–ª–∏—è){s2}—Ä–æ–∂–¥{s2}—Ä–∞–± {s2}–ø–ª–∞—Ç–∞{s0}}
\mark read1
{readdefine;{str};@{s2} ................... {s2}................... {s2}... {s2}... {s2}.. {s0}{s1}}
\v\r
\b ?({readcount}<=0) start
{define;{—Ñ–∞–º};@{substr;1;20;@{str} }}
{define;{–Ω–∞—á};@{substr;22;41;@{str} }}
{define;{–≥–æ–¥—Ä};@{substr;43;46;@{str} }}
{define;{–≥–æ–¥–Ω};@{substr;48;51;@{str} }}
{define;{–∑–∞—Ä};@{substr;53;55;@{str} }}
\v\r
{define;{ask}; @{read @{s2} {—Ñ–∞–º} {–Ω–∞—á} {–≥–æ–¥—Ä} {–≥–æ–¥–Ω} {–∑–∞—Ä} {s0} ([–¥–∞]/–Ω–µ—Ç)?}}
{ifsame;@{ask};–Ω–µ—Ç;/*;}
range of n is –º–∞–∫—Å_–Ω–æ–º–µ—Ä–∞
replace n(—Ä–∞–±–æ—Ç–Ω–∏–∫=n.—Ä–∞–±–æ—Ç–Ω–∏–∫+1) where (n.tid=0)
range of r is —Ä–∞–±–æ—Ç–Ω–∏–∫
append to —Ä–∞–±–æ—Ç–Ω–∏–∫ (–Ω–æ–º–µ—Ä=n.—Ä–∞–±–æ—Ç–Ω–∏–∫,
		    –∏–º—è="{—Ñ–∞–º}",
		    –Ω–∞—á–∞–ª—å–Ω–∏–∫=max(r.–Ω–æ–º–µ—Ä where r.–∏–º—è="{–Ω–∞—á} *"),
		    —Ä–æ–¥–∏–ª—Å—è = {–≥–æ–¥—Ä},
		    –Ω–∞—á–∞–ª_—Ä–∞–±–æ—Ç—É = {–≥–æ–¥–Ω},
		    –∑–∞—Ä–∞–±–æ—Ç–æ–∫={–∑–∞—Ä}
) where (n.tid=0)
{ifsame;@{ask};–Ω–µ—Ç;*/;}
\g
{ifeq;@{tuplecount};1;;{type @{s3}–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –∑–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω{s0}}}
\v\r
\b read1
\mark retall
retrieve (p.all)
\g
\branch start1
\mark clr
{define;{where};1>0}
\v\r
\b start
\mark exit
{type –ö–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã}\v\r
