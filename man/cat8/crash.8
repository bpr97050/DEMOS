
CRASH(8)        ДЕМОС. Сопровождение системы        CRASH(8)


ИИММЯЯ
        ccrraasshh - аварийное завершение работы системы.

ООППИИССААННИИЕЕ
        В этом разделе описывается что происходит при  оста-
        нове системы и как исследовать образ памяти системы.

        Когда происходит останов системы, на  консоль  выда-
        ется  сообщение вида ``panic: некоторое сообщение'',
        создается дамп системы, и запускается автоматическая
        процедура   перезагрузки,   описанная  в  _r_e_b_o_o_t(8).
        (Если автоперезагрузка не включена в системе, то она
        просто встанет в этом месте.) Если при проверке фай-
        ловой системы не обнаружены неожиданные  разрушения,
        возобновляется  многопользовательский  режим работы.
        Если автоматическая  перезагрузка  не  включена  или
        если  автоматическая  проверка файловой системы выя-
        вила крупные разрушения, то файловую систему следует
        проверить и восстановить вручную с помощью программы
        _f_s_c_k(8) перед продолжением работы.

        Если система останавливается или зависает без  сооб-
        щения,  есть возможность остановить ее и получить ее
        образ памяти.  Если включена автоматическая перезаг-
        рузка,  ее  можно  вызвать с пульта, что повлечет за
        собой  обычную  последовательность  действий  записи
        образа памяти, загрузки и проверки файловой системы.

        На СМ-4  для  этого  нужно  остановить  процессор  и
        запустить  его с адреса 040 (БЕЗ СБРОСА! Используйте
        ППРРООДД но не ППУУССКК).   На  консоли  появится  сообщение
        ``_p_a_n_i_c:  _f_o_r_c_e_d _f_r_o_m _c_o_n_s_o_l_e'' и начнется автомати-
        ческая перезагрузка.  Если это не проходит, то образ
        первых 248К памяти можно записать на МЛ.  Установите
        ленту (с кольцом!), остановите процессор и запустите
        его с адреса 044 (СО СБРОСОМ! т.е. клавишей ППУУССКК).

        На СМ-1420 для записи дампа  памяти  на  диск  нужно
        выполнить следующую последовательность действий:

        нажать ССТТООПП
        набрать на регистре адрес 177707 (адрес R7)
        нажать ВВВВООДД ААДДРРЕЕССАА
        набрать на регистре значение 40
        нажать ЗЗААППИИССЬЬ
        отпустить клавишу ССТТООПП
        нажать ППРРООДДООЛЛЖЖИИТТЬЬ

        Для дампирования на магнитную ленту на СМ-1420  дос-
        таточно просто ввести адрес 044 и нажать ППУУССКК.

        После завершения записи остановите процессор и пере-
        загрузите  систему.   После  перезагрузки  или после
        неудачи  автоматической  проверки  файловой  системы
        проверьте  и  исправьте  файловую  систему вручную с
        помощью ffsscckk.  Если система не загружается, то после
        проверки   работоспособности  аппаратуры  необходимо
        восстановить систему с запасной копии.   Испорченную


                            -1-                      ДЕМОС/P


CRASH(8)        ДЕМОС. Сопровождение системы        CRASH(8)


        корневую  файловую  систему лучше исправлять, загру-
        зившись с другой корневой файловой системы (если это
        возможно, конечно).

        Система  постоянно  производит  некоторые   проверки
        своей целостности.  Если одна из этих проверок пока-
        жет какие-либо нарушения, произойдет останов системы
        с коротким сообщением о том, что произошло.

        Наиболее частой причиной останова  системы  является
        сбой  аппаратуры,  что  может  проявиться различными
        способами.  Здесь приводятся наиболее часто встреча-
        ющиеся  сообщения  с  указанием  возможных причин их
        появления:

        _I_O _e_r_r _i_n _s_w_a_p
                Произошла ошибка при записи или считывании с
                устройства  подкачки.   Диск  нужно наладить
                или заменить.

        _T_i_m_e_o_u_t _t_a_b_l_e _o_v_e_r_f_l_o_w
                Переполнилась таблица задержек.  При этом не
                должно  было  бы происходить останова.  Сле-
                дует увеличить таблицу (NNCCAALLLL в _p_a_r_a_m._c).

        _O_u_t _o_f _s_w_a_p
        _O_u_t _o_f _s_w_a_p _s_p_a_c_e
                Произошло  переполнение  области   подкачки.
                При этом не должно было бы происходить оста-
                нова, но ничего  лучше  пока  не  придумали.
                Нужно  увеличить  область подкачки.  Система
                пытается избежать этой ситуации, отказываясь
                запускать новые процессы, когда область под-
                качки достаточно заполнена (что  приводит  к
                появлению сообщения ``_N_omore_p_r_o_c_e_s_e_s'').

        &_r_e_m_a_p__a_r_e_a > _0_1_2_0_0_0_0
        __e_n_d > _0_1_2_0_0_0_0
                Система при загрузке обнаружила,  что  недо-
                пустимая  часть ее данных попадает в область
                памяти, управляемую KKDDSSAA55.  В случае первого
                сообщения  следует уменьшить размер сегмента
                данных ядра (без учета таблиц ffiillee,  pprroocc  и
                tteexxtt).   Во  втором  случае  могут  быть два
                варианта:  если  &rreemmaapp__aarreeaa  не   превышает
                0120000,  ядро  нужно  перекомпилировать без
                определения NNOOKKAA55.  Иначе, как  и  в  первом
                случае, нужно уменьшить сегмент данных ядра.

        _i_n_i_t _d_i_e_d
                Процесс-инициатор системы (процесс 1) закон-
                чился.   Исправить это можно только перезаг-
                рузкой.

        _C_a_n'_t _e_x_e_c /_e_t_c/_i_n_i_tЭто не обычный останов - система не перезаг-
                ружается.   Ситуация возникает при загрузке,
                если нельзя запустить  //eettcc//iinniitt.   Возможно
                /_e_t_c/_i_n_i_t  нет  в корневой файловой системе,


                            -2-                      ДЕМОС/P


CRASH(8)        ДЕМОС. Сопровождение системы        CRASH(8)


                или нет разрешения на  выполнение  (установ-
                лено что-нибудь вроде rrww--rrww--rrww--).

        _t_r_a_p _t_y_p_e %_o
                Неожиданное прерывание одного  из  следующих
                типов:

         0      ошибка шины (нечетный адрес слова);

         1      недопустимая команда;

         2      прерывание по команде BBPPTT;

         3      прерывание по команде IIOOTT;

         4      сбой по питанию (если не сработает автопере-
                загрузка);

         5      прерывание по команде EEMMTT ;;

         6      рекурсивный системный вызов (команда TTRRAAPP);

         7      программное прерывание;

        11      нарушение защиты памяти (нарушение сегмента-
                ции);

        12      нарушение четности.

        Иногда к типу прерывания может  быть  добавлено  020
        (восьмеричное).   Это  значит,  что прерывание прои-
        зошло, когда процессор работал в  режиме  "пользова-
        тель".

        В добавок к типу прерывания система печатает еще три
        (или четыре) числа:

        _k_a_6     содержимое регистра сегментации  области,  в
                которой находится системный стек;

        _a_p_s     место, где  процессор  во  время  прерывания
                сохранил слово состояния процессора;

        _p_c      счетчик команд системы во  время  прерывания
                (уже продвинутый на следующее слово);

        ___o_v_n_o  номер раздела, в котором произошло  прерыва-
                ние (только в случае оверлейного ядра).

        Существует много других сообщений при остановах,  но
        они  возникают  гораздо  реже.   Большинство  из них
        сообщают о несоответствиях внутри  ядра,  и  поэтому
        ``не могут быть'', если ядро  не изменялось.

        ППррооссммооттрр ооббррааззаа ппааммяяттии ссииссттееммыы

        Когда происходит останов, система  записывает  (или,
        по  крайней  мере пытается записать) образ памяти на


                            -3-                      ДЕМОС/P


CRASH(8)        ДЕМОС. Сопровождение системы        CRASH(8)


        момент останова в  конец  области  подкачки.   После
        перезагрузки  системы вызывается программа ssaavveeccoorree,
        которая сохраняет копию этого образа и активное ядро
        системы в указанном каталоге для дальнейшего анализа
        (см.  _s_a_v_e_c_o_r_e(8)).  С магнитной ленты  образ  можно
        считать на диск программой _d_d(1).

        Для анализа  образа  сначала  запустите  команду  ppss
        -aallxxkk и/или ppssttaatt -pp для выдачи таблицы процессов во
        время останова.  Используйте _a_d_b(1) с ключом --kk  для
        анализа  файла  с  образом и получите последователь-
        ность вызовов функций командами  $$cc  или  $$CC.   Если
        сегментация  или  стек вызовов нарушены, можно попы-
        таться выяснить, что произошло, исходя из  следующей
        информации:

        Регистры rr00, rr11, rr22, rr33, rr44, rr55,  sspp  и  KKDDSSAA66  (или
        KKIISSAA66  для машин без разделенного пространства инст-
        рукций и данных)  сохраняются  по  адресу  04,  если
        образ  памяти  не  был  записан на диск.  Если образ
        системы был записан на диск, эти  значения  оказыва-
        ются  по адресу 0300.  Значение KKDDSSAA66 (KKIISSAA66), умно-
        женное на 0100(8), дает адрес структуры "u"  и  сис-
        темного   стека  текущего  процесса.   Сдвиньте  эти
        адреса в область от 0140000 до 0142000.  rr55 - указа-
        тель фрейма (рамки) вызова языка Си.  По адресу (rr55)
        находится указатель на предыдущий фрейм.  По  адресу
        (rr55)+2  находится сохраненный ppcc вызывающей функции.
        Проследите эту цепочку вызовов до места, где  значе-
        ние  rr55  будет равно 0141756 (0141754 для оверлейных
        ядер), где хранится rr55 пользователя.   Если  цепочка
        нарушена,  найдите правдоподобную пару rr55, ppcc и про-
        должите оттуда.   В  большинстве  случаев  описанная
        процедура поможет понять, что же произошло.

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
        _a_d_b(1),   _b_o_o_t(8),   _f_s_c_k(8),    _p_s(1),    _p_s_t_a_t(1),
        _r_e_b_o_o_t(8), _s_a_v_e_c_o_r_e(8)






















                            -4-                      ДЕМОС/P

