
FSCK(8)         ДЕМОС. Сопровождение системы         FSCK(8)


ИИММЯЯ
       ffsscckk - проверка и восстановление файловой системы.

ФФООРРММААТТ
       //eettcc//ffsscckk --pp[_д_и_а_п] [--tt _и_м_я__ф_а_й_л_а] [--dd_т_и_п]
                 [_и_м_я__у_с_т_р...]
       //eettcc//ffsscckk [--yy] [--nn] [--ss_X] [--SS_X] [--tt _и_м_я__ф_а_й_л_а] [--dd_т_и_п]
                 [_и_м_я__у_с_т_р...]

ООППИИССААННИИЕЕ
       Первая  форма  вызова  программы  ffsscckk  с  ключом  --pp
       используется  для  проверки и восстановления заданных
       файловых систем в автономном режиме (без участия опе-
       ратора).   Этот  вариант вызова обычно используется в
       командном файле /_e_t_c/_r_c при загрузке ДЕМОС.

       Если не указано ни одно устройство  (последний  аргу-
       мент вызова опущен), проверяются стандартные файловые
       системы, имена устройств которых перечислены в  файле
       /_e_t_c/_f_s_t_a_b.  В этом случае после ключа --pp может зада-
       ваться диапазон проверяемых систем.   Если  у  разных
       файловых  систем  указаны  одинаковые  номера, то эти
       файловые системы проверяются параллельно,  что  уско-
       ряет  процесс  проверки.   Обычно номер 1 указывается
       для корневой файловой системы (она  проверяется  пер-
       вой).  Все другие файловые системы должны иметь боль-
       шие номера.  Файловые системы с номерами 0 и режимами
       монтирования, отличными от "rroo" и "rrww" не проверяются
       (см.  _f_s_t_a_b(5)).  Параллельно можно проверять  только
       файловые  системы  расположенные на разных физических
       носителях.

       После ключа --pp  можно  указывать  номера  проверяемых
       файловых  систем (аргумент _д_и_а_п) по файлу /_e_t_c/_f_s_t_a_b.
       Можно указать начиная с какого номера проверять  фай-
       ловые  системы (например, --pp2 или --pp2-), или диапазон
       номеров (например, --pp2-4) или каким номером закончить
       проверку  (например, --pp-3).  Если ничего не указано и
       последний аргумент вызова  ffsscckk  опущен,  проверяются
       все файловые системы.

       Далее перечислены ошибки в файловой системе,  которые
       команда  ffsscckk с ключом --pp исправляет без участия опе-
       ратора:

       -  I-узлы не имеют ссылок;

       -  счетчики связей в I-узле и реальное число связей с
          файлом не совпадают;

       -  блоки либо пропущены, либо  числятся  одновременно
          за файлом и в списке свободных блоков;

       -  неверные счетчики в суперблоке.

       По каждой исправленной ошибке выдается  диагностичес-
       кое  сообщение,  указывающее имя проверяемой файловой
       системы  и  проведенные  в   ней   изменения.   После


                            -1-                      ДЕМОС/P


FSCK(8)         ДЕМОС. Сопровождение системы         FSCK(8)


       успешного  восстановления ffsscckk выдает количество фай-
       лов в файловой системе, число свободных  и  использо-
       ванных блоков.

       Без ключа --pp ffsscckk  проверяет  файловую  систему  и  в
       интерактивном  режиме устраняет противоречивые ситуа-
       ции, возникшие в файловой системе.  Обнаружив ошибку,
       ffsscckk  задает вопросы и далее действует в соответствии
       с ответами оператора.  Отметим,  что  при  автономной
       работе ffsscckk может произойти некоторая потеря информа-
       ции, хранящейся в файловой системе.  Наличие потерян-
       ной информации может быть определено по диагностичес-
       ким сообщениям.  Программа ffsscckk начинает восстановле-
       ние  файловой  системы  только  после того, как будет
       получен ответ оператора по каждой директиве.  Если  у
       оператора  нет  полномочий  на запись в файловую сис-
       тему, то ffsscckk по умолчанию начнет работать  с  ключом
       --nn.

       Команда ffsscckk выполняет больше действий  по  коррекции
       файловой  системы,  чем  все  имевшиеся ранее команды
       ddcchheecckk (сейчас  не  используется),  nncchheecckk  и  iicchheecckk
       вместе взятые (надо отметить, что в сложных ситуациях
       эти команды все-таки могут  понадобиться;  однако  их
       использование  требует высокой квалификации системных
       программистов, обслуживающих данную установку).

       Вызвав ffsscckk для  интерактивной  работы,  в  командной
       строке можно указать следующие ключи.

       --yy или --YY
             В этом случае предполагается, что на  все  воп-
             росы  системы ffsscckk был дан положительный ответ.
             Этим  ключом  нужно  пользоваться   чрезвычайно
             осторожно,  т.к.  его задание дает ffsscckk возмож-
             ность продолжить работу даже в случае обнаруже-
             ния чрезвычайно опасных ошибок.

       --nn или --NN
             Предполагается, что на все вопросы ffsscckk был дан
             отрицательный  ответ.   Файловая система в этом
             случае закрыта для ffsscckk на запись.

       --ss_X   Не учитывается  существующий  список  свободных
             блоков,   на  диск  автоматически  записывается
             новый суперблок файловой системы.  Перед запус-
             ком  ffsscckk  с этим ключом следует предварительно
             размонтировать  файловую  систему.   Если   это
             невозможно,  нужно  дождаться  завершения  всех
             процессов и перезагрузить систему  сразу  после
             восстановления - это необходимо для того, чтобы
             испорченная  копия  суперблока,  находящаяся  в
             оперативной памяти, не была записана в файловую
             систему.

             Ключ --ss_X позволяет создать оптимальную  органи-
             зацию списка свободных блоков.  Существуют сле-
             дующие формы  использования  расширения  _X  для


                            -2-                      ДЕМОС/P


FSCK(8)         ДЕМОС. Сопровождение системы         FSCK(8)


             разных типов дисков:

             --ss33   (для RP03 или ЕС-5061)
             --ss44   (для  RP04,  RP05,  RP06,   СМ-5404   или
                   ЕС-5067)
             --ss_б_л_о_к_о_в__н_а__ц_и_л_и_н_д_р:_п_р_о_п_у_с_к_а_е_м_ы_х__б_л_о_к_о_в
                   (для остальных типов)

             Если цифра в  ключе  не  указана,  используются
             значения, заданные при создании и использовании
             файловой системы. Если  эти  значения  не  были
             определены, используется величина 400:9.

       --SS_X   Этот ключ аналогичен ключу --ss_X, но список  сво-
             бодных  блоков заменяется на новый только в том
             случае, если расхождений в файловой системе  не
             обнаружено.  Указание этого ключа предполагает,
             что ffsscckk по  умолчанию  получает  отрицательные
             ответы  на  все  возможные  вопросы.  Этот ключ
             полезен для реорганизации списка свободных бло-
             ков в корректной файловой системе.

       --tt или --TT
             Если ffsscckk не может получить  достаточно  памяти
             для  своих  таблиц,  используется рабочий файл.
             Если при вызове ffsscckk был  задан  этот  ключ  то
             указанный  при нем файл используется в качестве
             рабочего.  Если этот файл не указан, ffsscckk  пот-
             ребует от оператора указать имя рабочего файла.
             Данный файл не должен находиться в  проверяемой
             файловой системе; если он не является специаль-
             ным файлом и ранее не существовал, то, завершив
             работу, ffsscckk его уничтожит.

       --dd_т_и_п При  указании  этого  ключа  прописывается  или
             обнуляется  по всем входам в каталоги тип файла
             (см. _d_i_r(5)). Поле _т_и_п задается либо  буквой  nn
             (новая  файловая  система),  если надо отметить
             тип I-узла или тип файла в каталоге, либо  бук-
             вой  oo  (старая  файловая  система),  если надо
             обнулить типы I-узлов в каталоге.

       Программа ffsscckk находит следующие противоречия в  фай-
       ловых системах.

       1)  Блоки, ссылки на которые  имеются  более,  чем  в
           одном I-узле или списке свободных блоков.

       2)  Блоки, ссылки на которые  имеются  в  I-узле  или
           списке  свободных  блоков, находятся вне файловой
           системы.

       3)  Неверное число связей в I-узлах.

       4)  Неверна размерность каталога и номеров I-узлов  в
           каталоге.

       5)  Неверный формат I-узла.


                            -3-                      ДЕМОС/P


FSCK(8)         ДЕМОС. Сопровождение системы         FSCK(8)


       6)  Блоки нигде не учтены.

       7)  Проверка каталога:
           - файл, указывающий на отсутствующий I-узел;
           - неверно задан номер I-узла.
           - неверные ссылки ".." или ".".
           - отсутствующие ссылки ".." или ".".
           - несколько ссылок на один каталог.

       8)  Проверка суперблока:
           - I-узлов больше 65536;
           - под I-узлы отведено блоков больше, чем  имеется
           в файловой системе.

       9)  Неверный формат списка свободных блоков.

       10) Неверно задано общее число свободных блоков и/или
           свободных i-узлов.

       11) Проверка типа файлов отмеченных в каталоге.

       Файлы и каталоги, на которые отсутствуют ссылки, соз-
       даются  с верными ссылками в каталоге _l_o_s_t+_f_o_u_n_d.  Им
       присваиваются имена, равные номеру  I-узла.   Единст-
       венным   ограничением   является   то,   что  каталог
       _l_o_s_t+_f_o_u_n_d должен  быть  заранее  создан  в  корневом
       каталоге  проверяемой файловой системы и иметь доста-
       точные размеры.   Для  этого  (перед  запуском  ffsscckk,
       обычно  еще при создании файловой системы) в нем соз-
       дают некоторое число файлов или каталогов с последую-
       щим их уничтожением.

       Проверка устройств  небуферизованного  обмена  всегда
       выполнятся быстрее.

ДДИИААГГННООССТТИИККАА
       Предполагается, что сообщения,  выдаваемые  ffsscckk,  не
       требуют пояснений.

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
       _d_i_r(5),  _f_i_l_s_y_s(5),  _f_s_t_a_b(5),   _c_r_a_s_h(8),   _m_k_f_s(8),
       _m_k_l_o_s_t+_f_o_u_n_d(8), _r_e_b_o_o_t(8)

       Имеется отдельный документ по ffsscckk.

ЗЗААММЕЕЧЧААННИИЯЯ
       При проверке корневой файловой системы  нужно  указы-
       вать  блочное  (буферизованное) устройство или ключ --
       pp1-1, в этом случае по окончании проверки, если  фай-
       ловая система была модифицирована, ffsscckk автоматически
       перезагрузит систему.









                            -4-                      ДЕМОС/P

