
TM(4)             ДЕМОС. Специальные файлы             TM(4)


ИИММЯЯ
        ttmm - магнитные ленты СМ5300 (TM-11/TE-10).

ООППИИССААННИИЕЕ
        Данная группа специальных файлов позволяет  работать
        с  устройством СМ5300 как с последовательным файлом.
        Для определения номера магнитофона используются биты
        07  дополнительного  кода устройства.  Если дополни-
        тельный код устройства содержит бит 0200, после зак-
        рытия файла лента не перематывается на начало.

        Для  управления  устройством   используются   вызовы
        iiooccttll,   определенные  в  iinncclluuddee-файле  _s_y_s/_m_t_i_o._h.
        Выполнить команду управления магнитофоном можно  при
        помощи вызова

        iiooccttll(_t_a_p_e, MMTTIIOOCCTTOOPP, &_a_r_g);

        ssttrruucctt mmttoopp {
                sshhoorrtt   mmtt__oopp;          /* команда */
                uu__sshhoorrtt mmtt__ccoouunntt;       /* счетчик */
        } _a_r_g;

        Каждая  команда  (mmtt__oopp)  выполняется  mmtt__ccoouunntt  раз
        (если   это   имеет  смысл).  Реализованы  следующие
        команды:

        MMTTWWEEOOFF  - записать признак конца файла;

        MMTTFFSSFF   - пропустить файлы (перематывает ленту  впе-
                ред,  пока не будет найдено mmtt__ccoouunntt ленточ-
                ных маркеров, останавливается после  нужного
                ленточного маркера);

        MMTTBBSSFF   - пропустить файлы назад (перематывает ленту
                назад,  пока  не будет найдено mmtt__ccoouunntt лен-
                точных маркеров, останавливается перед  нуж-
                ным ленточным маркером);

        MMTTFFSSRR   пропускает mmtt__ccoouunntt записей;

        MMTTBBSSRR   возвращает ленту на mmtt__ccoouunntt записей назад;

        MMTTRREEWW   перематывает ленту на начало;

        MMTTOOFFFFLL  отключает магнитофон от машины; на "правиль-
                ных"  магнитофонах эта команда также разгру-
                жает ленту;

        MMTTNNOOPP   пустая команда.

        Для того, чтобы узнать  текущее  состояние  магнито-
        фона, нужно использовать вызов

        iiooccttll(_t_a_p_e, MMTTIIOOCCGGEETT, &_a_r_g);

        ssttrruucctt mmttggeett {
             sshhoorrtt   mmtt__ttyyppee;   /* тип устройства */


                            -1-                      ДЕМОС/P


TM(4)             ДЕМОС. Специальные файлы             TM(4)


             uu__sshhoorrtt mmtt__ddssrreegg;  /* регистр состояния */
             sshhoorrtt   mmtt__eerrrreegg;  /* регистр ошибок */
             sshhoorrtt   mmtt__rreessiidd;  /* счетчик оставшихся
                                   байтов */
             ddaaddddrr__tt mmtt__ffiilleennoo; /* номер текущего файла */
             ddaaddddrr__tt mmtt__bbllkknnoo;  /* номер текущей записи */
        } _a_r_g;

        Поле mmtt__ttyyppee заполняется кодом типа устройства:

        MMTT__IISSTTSS  - для накопителей типа TS-11, _t_s(4);

        MMTT__IISSHHTT  - для накопителей типа HT-11;

        MMTT__IISSTTMM  - для накопителей типа TM-11 (СМ5300).

        В поля mmtt__ddssrreegg  и  mmtt__eerrrreegg  записываются  значения
        аппаратных  регистров состояния и ошибок контроллера
        магнитных лент. Значение битов регистров контроллера
        можно  найти  в техническом описании контроллера МЛ.
        Поле mmtt__rreessiidd содержит остаточное значение  счетчика
        байтов контроллера МЛ.

        Поля mmtt__ffiilleennoo и mmtt__bbllkknnoo в текущей  версии  системы
        не  заполняются и сохранены для совместимости с вер-
        сией системы для СМ-1700.  Вызовы MMTTIIOOCCGGEETT и  MMTTIIOOCC--
        TTOOPP могут быть использованы не только для СМ5300, но
        и для других типов накопителей на  магнитных  лентах
        (см.  _t_s(4)).

        Для устройств, имеющих интерфейс TM-11,  допускается
        программируемое  изменение  плотности записи; если в
        дополнительном коде устройства установлен бит  0100,
        то  используется  плотность записи на ленту 1600 bpi
        (64 бита/мм), иначе -  800 bpi  (32 бита/мм).   Уст-
        ройство СМ5300 работает только с плотностью 800 bpi.

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
        _m_t(1), _t_a_r(1), _t_p(1), _t_s(4)

ДДИИААГГННООССТТИИККАА
        ttee%%dd: _n_o _w_r_i_t_e _r_i_n_g.
                Попытка записи на ленту  со  снятым  кольцом
                защиты.

        ttee%%dd:: _n_o_t _o_n_l_i_n_e.
                Указанный магнитофон выключен.

        ttee%%dd: _c_a_t'_t _s_w_i_t_c_h _d_e_n_s_i_t_y _i_n _m_i_d-_t_a_p_e.
                Попытка программно изменить плотность записи
                в середине ленты.

        ttee%%dd: _h_a_r_d _e_r_r_o_r _b_n %_d _e_r=%_b
                Операция обмена завершилась неудачей  выдает
                логический  номер блока и состояние регистра
                ошибок контроллера. При работе  в  "прозрач-
                ном"  режиме  будет  сделано  еще  несколько
                попыток выполнить операцию.   В  стандартном


                            -2-                      ДЕМОС/P


TM(4)             ДЕМОС. Специальные файлы             TM(4)


                режиме любая ошибка считается фатальной.

        ttee%%dd: _l_o_s_t _i_n_t_e_r_r_u_p_t.
                Текущая операция не была выполнена в течении
                "разумного"  интервала  и  была  прервана по
                таймеру. Данная  ситуация  может  возникнуть
                при  выключении устройства в момент выполне-
                ния операции.  Для того, чтобы  снова  полу-
                чить  доступ к устройству его следует заново
                открыть.

ЗЗААММЕЕЧЧААННИИЯЯ
        Если при работе с устройством буферизованного обмена
        фиксируется  ошибка устройства, работа с лентой зап-
        рещается до закрытия специального файла.

        Использование вызова MMTTIIOOCCGGEETT значительно  затрудня-
        ется  тем, что он возвращает состояние накопителя на
        МЛ в аппаратно-зависимой форме, что  требует  знания
        конкретной аппаратуры и делает программы, использую-
        щие этот вызов, непереносимыми. Возможно, будет реа-
        лизован "универсальный" интерфейс к драйверу магнит-
        ных лент.





































                            -3-                      ДЕМОС/P

