
            дддд   ееееее   м     м    oooo     сссс
           д   д   е        мм   мм   o    o   с    с
          д    д   е        м м м м   o    o   с    с
          д    д   еееее    м  м  м   o    o   с
          д    д   е        м     м   o    o   с
          д    д   е        м     м   o    o   с    с
         дддддддд  ееееее   м     м    oooo     сссс



          демосдемосдемосдемосдемосдемосдемосдемосде
          емосдемосдемосдемосдемосдемосдемосдемосдем
          мо                                      мо
          ос                                      ос
          сд        ОПЕРАЦИОННАЯ СИСТЕМА          сд
          де                                      де
          ем               ДЕМОС                  ем
          мо                                      мо
          ос                                      ос
          сд                                      сд
          де             Версия 1.0               де
          ем                                      ем
          мо                                      мо
          сдемосдемосдемосдемосдемосдемосдемосдемосд
          демосдемосдемосдемосдемосдемосдемосдемосде







        УНИВЕРСАЛЬНЫЙ ПОЛИЭКРАННЫЙ РЕДАКТОР ТЕКСТОВ







                  Руднев Алексей Петрович












                       МОСКВА - 1985









                                                           1









     В документе  описан  полиэкранный  диалоговый  редактор
текстов RED. Приводится инструкция по редактору; рассмотрена
процедура подключения к редактору новых типов  терминалов  и
краткие сведения о файле с описанием возможностей и характе-
ристик терминалов.






















































                              2






                         1. ВВЕДЕНИЕ


    Экранный редактор  RED работает под управлением операци-
 онной системы ДЕМОС. От большинства экранных редакторов RED
 отличается следующими особенностями:

      - возможна работа с несколькими файлами одновременно;

      - возможно образование на экране терминала  нескольких
        "окон" и одновременный просмотр нескольких файлов;

      - возможно воспроизведение сеанса при сбое ЭВМ;

      - редактор динамически настраивается на терминал  (*1)
        ;

       - имеются  макропеременные  для  хранения  фрагментов
        текста, наборов команд редактора и т.п.;

      - имеется возможность  переопределения  функциональной
        клавиатуры и введения новых функциональных клавиш;

      - возможно использование  "внешних"  команд,  то  есть
        команд операционной системы ДЕМОС;

                 2. ОБЩЕЕ ОПИСАНИЕ РЕДАКТОРА


           2.1. Основные принципы редактирования.


    Редактор RED выделяет на экране терминала несколько раз-
 личных  зон.  Основную  часть  занимает  "окно" отображения
 файла, обведенное рамкой, самая нижняя  строка  оставляется
 для  ввода "параметров команд" редактора и для выдачи сооб-
 щений. В этой же строке высвечивается номер  строки  и  имя
 редактируемого файла (рисунок 1).









__________________________

(*1)   Используется "базa данных терминалов", то есть  файл,
       содержащий  описание свойств всех известных типов ви-
       деотерминалов (файл /etc/termcap в ОС ДЕМОС ).







                              3







                       экран тeрминала

         ............................................
         . ---------------------------------------- .
         . :                                      : .
         . :                                      : .
         . :                                      : .
         . :       <окно>                         : .
         . :                                      : .
         . :                                      : .
         . :                                      : .
         . :                                      : .
         . :                                      : .
         . ---------------------------------------- .
         . arg:<параметры>        file:a line 10    .
         ............................................

                            Рис. 1




    При необходимости "окно"  можно  поделить  на  несколько
 меньших  окон  и  изобразить  в них разные файлы или разные
 части одного файла. каждое "окно" показывает часть  закреп-
 ленного за ним файла.

    Можно редактировать файл, используя клавиши со стрелками
 или  с  надписями  <RETURN>  (<ВК>),  <LINE  FEED>  (<ПС>),
 <HOME>, <TAB> для перемещения курсора внутри "окна";  можно
 вводить  текст,  используя  основную  клавиатуру терминала.
 Кроме того, с помошью управляющей клавиатуры можно  вводить
 "команды" редактора RED, которые в частности позволяют:

      - двигать "окно" вверх, вниз, вправо, влево по файлу;

       - уничтожать,  вставлять  или  перемещать   фрагменты
        текста  как внутри одного файла, так и между разными
        файлами;

      - переключать "окна" с файла на файл, записывать файлы
        в архив, создавать новые "окна";

      - осуществлять поиск строк по контексту.

    При этом на экране изображается текущее состояние редак-
 тируемых файлов. Редактор накапливает информацию об измене-
 ниях во временном буфере. По окончаниии редактирования вво-
 дится команда <EXIT> (выход). При этом измененные файлы пе-
 реписываются обратно в архив, а старое состояние файлов за-
 поминается под именем <старое имя>.bak (к имени добавляется
 суффикс  bak).  При  необходимости  можно  прервать   сеанс






                              4






 редактирования, не запоминая изменений. Редактор запоминает
 имена файлов и состояние экрана (в справочнике /tmp ) и при
 повторном вызове RED  можно продолжить редактирование точно
 с прерванного места. Редактор ведет также протокол  работы,
 позволяющий  практически полностью повторить процесс редак-
 тирования в случае сбоя.

                    2.2. Вызов редактора


    Для редактирования файла <имя> (*1)  начиная  со  строки
 <номер>, необходимо набрать команду:

  red <имя> [<номер>]

 После вызова редактора курсор установится на строку <номер>
 файла  <имя>. (По умолчанию курсор устанавливается примерно
 на 10 строку файла).

   Можно продолжить редактирование с  того  места,  где  оно
было окончено последний раз. Для этого служит команда

        red


   В случае сбоя системы или редактора сеанс  редактирования
можно воспроизвести с помощью команды:

        red -


   При вызове RED может оказаться, что редактору не доступны
характеристики  вашего тeрминала. В этом случае перед первым
вызовом редактора введите команду

        eval `tset -s`

либо, если тип вашего терминала не соответствует описанию  в
файле /etc/ttytype , то укажите также тип терминала:

        eval `tset -s  <тип>`

Подробнее о настройке на терминал рассказано в разделе 4.


__________________________

(*1)Ниже в квадратные скобки [] взяты  необязательные  пара-
   метры,  в  угольники  <> взяты условные обозначения, под-
   черкнуты имена приказов или файлов операционной системы.









                              5






    2.3. Использование клавиатуры и ввод команд редактора


    В данном разделе описаны правила ввода  приказов  и  ис-
 пользования клавиатуры при работе с редактором RED, а также
 изображение символов из файла на экране терминала.  Некото-
 рая сложность состоит в том, что редактор расчитан на рабо-
 ту на самых разных  терминалах, возможности которых заранее
 неизвестны.

    Условно клавиатуру любого терминала можно  разделить  по
 функциям на следующие части:

 1)   Клавиши, не вырабатывающие кодов (такие, как  <SHIFT>,
      <ROLL>  и  т.п.). из них нас интересует только клавиша
      <CTRL> (или <УПР>), которая вызывает при одновременном
      нажатии основной клавиши клавиатуры выработку управля-
      ющих кодов ("control-символы");.

 2)   Основная клавиатура - содержит  символы  кода  "ASCII"
      или  "КОИ-8".  В  зависимости от  набора этих символов
      терминалы можно разделить на три группы;

      1)   Терминал может отображать только латинские  (про-
           писные и строчные) буквы и все специальные симво-
           лы кода "ASCII";.

      2)   Терминал  может   отображать   только   прописные
           русские и латинские буквы;.

      3)   Терминал  может  изображать  руские  и  латинские
           строчные и прописные буквы и все специальные сим-
           волы, то есть все символы кода "КОИ-8" (например,
           терминал "Электроника-15-ИЭ-0013").

 3)   Общепринятые управляющие клавиши:

           - стрелки влево, вправо, вверх, вниз;

           - <RETURN> (<Возврат Каретки>);

           - <LINE FEED> (<Перевод Строки>);

           - <TAB> (<Табуляция>);

           - <HOME> (<Курсор в начало экрана>).

 4)   Дополнительная функциональная клавиатура, обычно  сов-
      мещенная  с цифровой (например, терминал "Электроника-
      15-ИЭ-0013" имеет группу клавиш с надписями "0" - "9",
      которые  в  зависимости от режима работы являются либо
      обычными символами "0"-"9", либо вырабатывают управля-
      ющие  последовательности  кодов и могут использоваться






                              6






      как функциональные клавиши; на  терминалах  серии  VTA
      2000  клавиши  "0" - "9" вырабатывают управляющие коды
      при одновременном нажатии на клавишу "УПР").

 5)   Дополнительные управляющие клавиши, например:

         <IL>, <DL>, <IC>, <DC>, <ERASE>, -  на   VDT-52100c
         или аналогичные клавиши на других терминалах; в ре-
         жиме "off line" они обычно редактируют текст на эк-
         ране терминала.

    Для работы в RED достаточно использовать основную клави-
 атуру и общепринятые управляющие клавиши. В то же время для
 упрощения работы можно использовать  функциональную  клави-
 атуру  либо  дополнительные  управляющие  символы, если они
 есть на вашем терминале.

 2.3.1. Отображение информации на экране видеотерминала


    Редактор расчитан  на  работу  с  текстами,  содержащими
 строчные  и  прописные  русские  и  латинские  буквы в коде
 "КОИ-8". В файле могут также содержаться неграфические сим-
 волы.  В  зависимости  от возможностей терминала, некоторые
 символы файла могут изображаться на экране в  виде  двух  и
 более символов.

 1)   Символы с кодами 0 - 037 изображаются в виде пары сим-
      волов: символа "забой" (светлый прямоугольник) и одно-
      го из символов @, A-Z,[,], \ ,  _,^,  код  которого  в
      "КОИ-8"  равен коду исходного, плюс 0100. Если на тер-
      минале нет символа "забой", высвечивается @  либо  ха-
      рактерный для данного терминала неграфический символ.

 2)   Если терминал не имеет прописных букв (то есть работа-
      ет в режиме "LCASE"), то отсутствующие символы изобра-
      жаются следующим образом:

 <строчные буквы>
       - прописными  буквами

 <прописные буквы>
       - \<прописная буква>,

 \ (обратная черта)
       - две обратные черты (\\),

 ~ (<тильда>)
       - \^ (<обр.черта><надчерк>),

 ` (<обр.кавычка>)
       - \' (<обр.черта><кавычка>),







                              7






 } (<закр.фигурная скобка>)
       - \)  (<обр.черта><закр.скобка>)

 { (<откр.фигурная скобка>)
       - \(  (<обр.черта><откр.скобка>)

 | (<вертикальная черта>)
       - \!. (<обр.черта><воскл.знак>)

 3)   Если терминал не имеет русских букв, то они  изобража-
      ются парой символов #<латинская буква>, причем пропис-
      ным "А"- "Я" соответствуют прописные
       "A"-"Q", а строчным - строчные "a"-"q" в соответствии
      с кодом "КОИ-8".

 4)   Символы 0200 - 0277 и 0377 изображаются последователь-
      ностью

                               @<kkk>


      где <kkk> - трехзначный код символа, a "@" - "забой"
      либо соответствующий ему символ (см. пункт 1).

         Символ "DEL" (код 0177) изображается как

              @# (<забой><диез>).


 2.3.2. Ввод информации с клавиатуры


    Ввод текста с клавиатуры практически не зависит от  типа
 терминала.

 1)   Специальные символы (пробел, запятая, и т.д.) с кодами
      040 - 077 вводятся обычным образом.

 2)   Латинский  регистр  включается  при   нажатии   клавиш
      <CTRL>+"O"  (клавиша  "ЛАТ"  на терминалах "Электрони-
      ка").  На  латинском  регистре  вводятся  прописные  и
      строчные  буквы  (прописные  в  верхнем  (на  VTA 2000
      -"лат") регистре клавиатуры и строчные - в нижнем  (на
      VTA  2000 -"рус")), специальные символы "\", "[", "]",
      и другие символы кода "КОИ-8"  с  кодами  от  0100  до
      0176.

 3)   Русский регистр включается нажатием <CTRL>+"N" (клави-
      ша "рус" на терминале "Электроника"). После этого вво-
      дятся в зависимости  от  регистра  клавиатуры  русские
      прописные или строчные буквы.








                              8






 4)   Признак неграфического  символа  ("забой"  на  экране)
      вводится специальным приказом редактора "ESCAPE".

    В зависимости от режима работы некоторые  символы  могут
 на экране изображаться в виде пары символов.

 2.3.3. Ввод приказов в редактор RED


    Для управления редактированием, просмотра файлов и  дру-
 гих  действий используются "приказы" редактора RED, которые
 идентифицируются "командами", вводимыми с клавиатуры.  (*1)
 Команды вводятся нажатием 1 или 2-х управляющих или функци-
 ональных клавиш. В зависимости  от  конкретного  терминала,
 они могут вводиться одним из нескольких способов.

   1)   На любом терминале - последовательным нажатием  кла-
        виш

                     <LINEFEED> <идент. символ>

           где <идент. символ> - один из  символов  основной
           клавиатуры.

   2)   В большинстве случаев - одновременным нажатием  кла-
        виш

                  <CTRL><идентифицирующий символ>


   3)   При наличии дополнительной функциональной клавиатуры
        - нажатием одной или двух клавиш на ней.

   4)   С  помощью  дополнительной  управляющей   клавиатуры
        (клавиши "IL", "DL" и им аналогичные).

   В  приложении  приведены  кодировки  команд  на  наиболее
распространенных типах терминалов.

   Ряд  команд,  управляющих  движением  курсора,   вводится
только  с  управляющей клавиатуры (стрелки, "RETURN", "TAB",
"HOME").

   В приложении приведены  таблицы  управляющих  клавиш  для
терминалов наиболее распространенных типов.
__________________________

(*1)Ниже термин "команда" используется для  обозначения  ко-
   мандной  последовательности,  вводимой с клавиатуры и ис-
   пользуемой для  идентификации  "приказа",  который  может
   совпадать  с  "командой" либо состоять из нескольких "ко-
   манд".







                              9






               2.4. Окна и редактируемые файлы


    Редактор показывает участок редактируемого файла на  эк-
 ране  терминала в "окне". Имя файла, который нужно редакти-
 ровать первым, указывается в параметрах вызова RED, при не-
 обходимости  можно  перейти  к  другому  файлу, использовав
 <USE>.  Кроме того, редактор автоматически подключает  файл
 /usr/lib/re.std , который содержит справочную информацию по
 редакторуу, и псевдо-файл "#" (*1) , в котором запоминаются
 все отмеченные или исключенные строки.

   "Окно"  можно разделить на несколько меньших "окон" с по-
мощью  приказа <M-PORT>, отобразив в каждом участок того или
иного файла. Для упрощения переключения с файла на файл  лю-
бое окно может быть связано также с "альтернативным файлом";
приказ <USE> без параметров меняет местами основной  и  аль-
тернативный  файлы в текущем окне. При входе в редактор аль-
тернативным является файл /usr/lib/re.std , содержащий крат-
кое описание редактора.


                        Пример  окон

            ....................................
            .----------------------------------.
            .i             ii                 i.
            .i текущее     ii   еще одно      i.
            .i окно        ii   окно          i.
            .i             ii                 i.
            .iдлиннаястрока>i                 i.
            .i             ii                 i.
            .i             ii                 i.
            .;             ii                 i.
            .;             ii                 i.
            .----------------------------------.
            .arg:          file: a line 10     .
            ....................................

                           Рис. 2



   Для уничтожения окон служит приказ <ARG><M-PORT>. Измене-
ния,  произошедшие в файле, повторяются одновременно во всех
окнах, связанных с ним.

   Среди всех окон имеется "текущее",  в  котором  находится
__________________________

(*1)имя "#" не относится к  реально  существующему  файлу  и
   может встречаться только в приказах <USE> и <M-PORT>.







                             10






курсор. Левые и правые символы-ограничители несут  следующую
информацию:

слева:

;  - данной строки в файле нет;

i  - строка есть в файле  и  окно  начинается  с  1  колонки
   файла;

<  - окно начинается не с 1 колонки  файла,  а  сдвинуто  по
   файлу вправо;

справа:

i  - в строке нет информации справа от окна;

>  - строка продолжается за правую границу "окна".

   Все изменения, сделанные на экране,  запоминаются  и  при
выходе из редактора по приказу <EXIT> измененные файлы запи-
сываются в архив. При этом старые варианты файлов переимено-
вываются  путем  добавления  суффикса , и в результате также
сохраняются в архиве. Имеется возможность записать файл  под
текущим  или под новым именем в  архив еще в процессе редак-
тирования (приказ <SAVE>), а также выйти  из  редактора  без
записи измененных файлов.

               2.5. Переменные и макрокоманды


    В процессе редактирования часто возникает  необходимость
 временно  запомнить  какую либо информацию, текст или набор
 команд и затем многократно их использовать. Для этого в ре-
 дакторе  RED  служат "переменные". Имеется 26 переменных, с
 именами от "a" до  "z"  (имя  состоит  из  одной  латинской
 буквы), в которых можно хранить следующую информацию:

      - запоминать положение курсора в файле и затем исполь-
        зовать его для возврата в нужную точку либо для ука-
        зания одной из границ действия  приказа  в  приказах
        <CLOSE>, <OPEN>, <PICK>;

      - запоминать  текст для использования  его  в  приказе
        <PICK>;

      - запоминать последовательность команд  и  текста,  то
        есть макрокоманду.

    Вызов переменной обозначается как "$имя", а запись в нее
 -  ">имя",  где  "имя" - латинская малая буква. В некоторых
 приказах переменная обозначается без символов "$" или ">".







                             11






                  2.6. Что делать при сбое


    Редактор RED  обеспечивает двойную защиту от потери  ин-
 формации.  Во  первых,  при  записи файла старое содержимое
 сохраняется под именем <старое имя>.bak. Во вторых,  редак-
 тор  при  работе записывает файл /tmp/rettnn.name, где nn -
 два последних символа имени терминала, а name - идентифика-
 тор пользователя. Этот файл содержит протокол всей работы и
 позволяет воспроизвести сеанс редактирования еще раз.  Если
 произойдет  сбой  машины  либо  редактора,  можно повторить
 сеанс командой:

  red -


 По данной команде произойдет повторение всего сеанса  ра-
 боты,  за  исключением  одного - двух последних символов,
 после чего управление передастся на клавиатуру и вы  смо-
 жете  продолжить редактирование. В случае, если сбой про-
 изошел в момент записи файла или в процессе  редактирова-
 ния  использовался  приказ  <SAVE>  без параметров, перед
 повторением сеанса необходимо восстановить исходное  сос-
 тояние  редактируемых файлов, скопировав их при необходи-
 мости из файлов с суффиксом ".bak".


                  3. ПРИКАЗЫ РЕДАКТОРА RED


    Приказы RED  идентифицируются командными  последователь-
 ностями  и  могут быть введены как с параметрами, так и без
 параметров:

                   <КОМАНДА>
                   <ARG>параметры<КОМАНДА>


    Здесь и далее угловыми скобками обозначены  команды  ре-
 дактора, которые вводятся с управляющей клавиатуры.

    Список команд и их ввод с клавиатуры описываются в  при-
 ложении.
















                             12






                 3.1. Ввод параметров <ARG>


    В случае приказа с параметрами сначала вводится  команда
 <ARG>,  затем  параметры  и  затем соответствующая командa.
 Так, например, для подвода к  100 строке необходимо:

 1)   ввести  команду   <ARG>   (например,   нажав   клавишу
      <ERASE>);

 2)   набрать параметр (в данном случае число 100);

 3)   ввести команду <GOTO> (например, нажав <LINE FEED> "."
      или функциональную клавишу 4).

    Сокращенно это записывается так:

                       <ARG>100<GOTO>


    Параметры бывают трех типов:

 1)   Произвольный текст (например, имя файла или строка для
      поиска);

 2)   Числовой (например, номер строки);

 3)   Указатель части файла.  Этот  параметр  встречается  в
      приказах, которые запоминают, раздвигают или уничтожа-
      ют текст. Для указания участка на экране необходимо:

           - подвести курсор на начало указываемого участка;

           - ввести команду <ARG>;

           - клавишами со стрелками подвести курсор к  концу
             области; при этом выдается сообщение:

             "cursor defined"


           - ввести команду (например, <PICK>).

         Для движения курсора можно использовать клавиши  со
      стрелками,  <RETURN>, <TAB>, <BACK-TAB>. Область, ука-
      занная курсором, зависит от начального и конечного по-
      ложений курсора:

           - Если начальная колонка совпадает  с   конечной,
             то приказ действует на строки между начальной и
             конечной строками включительно;








                             13






           - Если начальная строка совпадает с конечной,  то
             приказ действует на участок этой строки.

           - В противном случае областью  действия  является
             прямоугольная  область между начальным и конеч-
             ным положениями курсора.


                    Пример указания области

               ..................................
               .  окно                          .
               .     нач.положение              .
               .     1***************           .
               .     **область*******           .
               .     **действия******           .
               .     ****************2          .
               .                     кон.       .
               .                     положение  .
               ..................................

               ..................................
               .  окно                          .
               .     нач.положение              .
               .*****1**************************.
               .*******область****на всю********.
               .*******действия****ширину*******.
               .*****2**************************.
               .     кон.                       .
               .     положение                  .
               ..................................

               ..................................
               .  окно видения                  .
               .     нач.положение              .
               .     1***************2          .
               .                     кон.       .
               .                     положение  .
               ..................................

                            Рис. 3



                Если нужно указать участок файла, который не
             умещается  на экране, то его начало (или конец)
             запоминают в какой-либо переменной  (устанавли-
             вают курсор и вводят <ARG>>"имя"<RETURN>), под-
             водят  курсор  к  концу  (или  к  началу  соот-
             ветственно)  указываемого участка и вводят при-
             каз:

                     <ARG>$"имя"<RETURN>






                             14






             Результат равносилен указанию курсором  участка
             файла  от точки, запомненной в переменной "имя"
             до  текущего  положения  курсора.  В   приказах
             <OPEN>, <CLOSE>, <PICK> можно сразу вводить со-
             ответствующую команду без <RETURN>.

                При вводе  параметров  выдается  приглашение
             "arg:",  для  отмены неверно набранных символов
             служит <B-SPACE>.

                 3.2. Восстановление экрана


    При случайном нарушении изображения на экране  терминала
 его можно восстановить, набрав:

         <ARG>re<RETURN>


              3.3. Движение курсора внутри окна


 3.3.1. Клавиши со стрелкамми


    При нажатии на соответствующую клавишу курсор  перемеща-
 ется на одну позицию:

 <стрелка вверх>
    вверх;

 <стрелка вниз>
    вниз;

 <стрелка вправо>
    вправо;

 <стрелка влево>
    влево.

 На границе окна происходит переход курсора на  противопо-
 ложную границу.

 3.3.2. Приказы <HOME> и <RETURN>



 <HOME>
    - курсор переходит в левый верхний угол окна видения;

 <RETURN>- Курсор переходит на начало следующей строки; если
    строка  была последней, окно перемещается вниз по файлу;
    если оно начиналось не с 1 колонки файла, оно  сдвинется






                             15






    на первую колонку;

 <ARG>приказ<RETURN>
    - ввод директивы редактора (описаны ниже);

 3.3.3. Табуляция (<tab>, <b-tab>, <set-tab>)


 <TAB>
    - Табуляция; курсор перемещается  на  очередную  позицию
    табуляции. По умолчанию это - 9, 13, 25, 33, 31, 49, 57,
    65 и 73 колонки;

 <ARG>N<TAB>
    - эквивалентно N табуляциям подряд;

 <B-TAB>
    - табуляция назад; полностью аналогично <TAB>, но курсор
    движется назад;

 <SET-TAB>
    - устанавливает новую позицию табуляции в текущей колон-
    ке;

 <ARG><SET-TAB>
    - снимает позицию табуляции в текущей колонке;

              3.4. Редактирование внутри строки


 3.4.1. Ввод текста. Режим вставки (<INSERT>)


    Если в редактируемый файл разрешена запись, то  символы,
 набираемые  на клавиатуре, попадают в текущий файл так, как
 это изображается на экране. При достижении курсором  правой
 границы  экрана  он  автоматически сдвигается на 30 колонок
 вправо. При достижении курсором 72 колонки  файла  выдается
 предупредительный звуковой сигнал.

    Для вставки символов служит режим  вставки  "INSERT";  в
 этом  режиме  при  наборе символов строка раздвигается. Для
 включения и выключения режима служит приказ:

 <INSERT>
    - включить/выключить режим вставки;













                             16






 3.4.2. Уничтожение символов (<DEL-CH> и <BACKSPACE>)


    Для уничтожения символов внутри строки служат две коман-
 ды:

 <DEL-CH>
    - уничтожается текущий символ, правая часть строки сдви-
    гается влево на 1 позицию;

 <B-SPACE>- отменяет предыдущий  символ;  в  режиме  вставки
    строка уплотняется. Действует и при вводе параметров.

 3.4.3. Ввод нетекстовых символов (<ESCAPE>)


    Нетекстовыми (неграфическими) являются символы с  кодами
 0-037,  0177-0277,, 0377. Для их ввода в файл служит специ-
 альный "ESCAPE"-символ, который  преобразует  следующий  за
 ним символ в нетекстовый.

    Для ввода символа с кодом 0-037 необходимо:


         - ввести команду <ESCAPE>;

         - ввести соответствующий "CTRL"-символ либо пропис-
           ную  латинскую  букву, либо один из символов "@",
           "[","]","\", "_", "^".

 На экране появится пара символов: светлый квадратик (либо
 символ, его заменяющий), и текстовый символ. При записи в
 файл эта пара заменится на  один  символ  с  кодом  <сим-
 вол>&037 (*1) , то есть букве "A" соответствует код 01  и
 так далее.

   Для ввода символов с кодами 0200-0277 и 0377:


        - введите <ESCAPE> ;

        - введите трехзначный код символа.

   Символ <DEL> (0177) вводится как <ESCAPE>#.





__________________________

(*1)Символ "&" означает "поразрядное логическое умножение".







                             17






                  3.5. Перемещение по файлу


 3.5.1. Запоминание места в файле



 <ARG>>"имя"<RETURN>
    Текущее  положение  курсора  запоминается  в  переменной
    "имя".  Затем  эта  переменная может быть использована в
    приказах <OPEN>, <CLOSE>, <PICK>, <GOTO>.

 3.5.2. Подвод к строке (<GO TO>)


    В редакторе  строки  текста  считаются  пронумерованными
 подряд. Для подвода к нужной строке служит приказ <GOTO>.

 <GOTO>
    - подвод к началу файла;

 <ARG><GOTO>
    - подвод к концу файла;

 <ARG>N<GOTO>
    - подвод к строке номер "N" (N - целое число);

 <ARG>$"имя"<GOTO>
    - подвод к точке, запомненной под именем "имя";

 Номер текущей строки выдается на нижней строке экрана.

 3.5.3.  Листование  файла   (<+PAGE>,   <-PAGE>,   <+LINE>,
 <-LINE>)


    Страницей считается часть файла, умещающаяся  в  текущем
 окне на экране.

 <+PAGE>
    - перемещает окно на 1 страницу вниз по файлу;

 <-PAGE>
    - перемещает окно на 1 страницу вверх;

 <ARG>N<+PAGE>

 <ARG>N<-PAGE>
    - перемещает окно вниз (вверх) на N страниц.

    Для перемещения окна с точностью до строки служат прика-
 зы <+/-LINE>.







                             18






 <ARG>N<+LINE>
    - вперед на N строк;

 <ARG>N<-LINE>
    - назад на N строк;

 <+LINE>
    - вперед на 8 строк

 <-LINE>
    - назад на 8 строк;

 <ARG><+LINE>
    - Сдвинуть окно вниз так,  чтобы  текущая  строка  стала
    первой на экране;

 <ARG><+LINE>
    - Сдвинуть окно вверх так, чтобы  текущая  строка  стала
    последней на экране;

 3.5.4. Сдвиг окна вправо/влево

 (<RIGHT> и <LEFT>)


 <RIGHT>
    - сдвинуть окно вправо на 30 колонок;

 <LEFT>
    - сдвинуть окно влево на 30 колонок;

 <ARG>N<RIGHT>
    - сдвинуть окно вправо на N колонок;

 <ARG>N<LEFTT>
    - сдвинуть окно влево на N колонок;

    Приказ <RIGHT> выполняется автоматически, если при набо-
 ре  текста  курсор достиг правую границу экрана. По команде
 <RETURN> окно автоматически устанавливается на 1-ю  колонку
 файла.


        3.6. Контекстный поиск (<+SEARCH>, <-SEARCH>)


    Приказы <+/-SEARCH> вызывают поиск  заданного  образа  в
 файле  соответственно  вперед  или назад от текущего места.
 Для указания текста, который нужно найти, служит форма при-
 каза:









                             19






 <ARG>текст<+SEARCH>
     или

 <ARG>текст<-SEARCH>
     производится поиск указанного  текста  в  файле  вперед
    (назад)  от  текущего  положения  в  файле.  Если  текст
    найден, это место в  файле  высвечивается  на  экране  и
    курсор устанавливается на начало найденного текста, ина-
    че выдается предупредительное сообщение:

                     "search key not found"
                   (искомый образ не найден)


    Для продолжения поиска данного образа достаточно  ввести
 один из приказов

 <+SEARCH>
     или

 <-SEARCH>

         3.7. Чтение и запись файлов (<USE>, <SAVE>)


    Приказ <USE> служит для переключения редактора  с  файла
 на  файл. Для перехода к редактированию нового файла служит
 приказ:

 <ARG>имя<USE>
    начать редактировать файл "имя".

 При этом возможны следующие случаи:


    1)   Файл существует,  доступен  и  не  входит  в  число
         файлов,  которые  уже редактовались в данном сеансе
         работы. В этом случае  редактор  подключает  его  и
         высвечивает  в  текущем окне, а ранее редактировав-
         шийся файл становтся "альтернативным";

    2)   Файл уже редактировался в данном сеансе работы (хо-
         тя,  возможно, и не показывается ни в одном окне на
         экране терминала). В этом случае файл  отображается
         на  экране  со  всеми  уже  внесенными изменениями;
         Отметим, что приказ не позволяет прочитать файл  из
         архива  заново.  Текущий файл становится "альтерна-
         тивным";

    3)   Файл не существует. Редактор просит подтвердить не-
         обходимость создания нового файла:








                             20






                           "Create (y/n)?"
                          ("Создать(y/n)?")


         в случае положительного  ответа  создается  новый
         файл.

    Приказ <USE> без параметров переключает редактор на аль-
 тернативный файл. В частности, в начале сеанса он может ис-
 пользоваться для получения справочной информации  из  файла
 /usr/lib/re.std

 <SAVE>
    - запись текущего файла в архив; при этом исходный вари-
    ант файла переименовывается в <старое имя>.bak; (*1)

 <ARG>имя<SAVE>
    Происходит запись текущего файла в файл "имя".

    Приказ <SAVE> автоматически выполняется для  всех  изме-
 ненных  в процессе работы файлов при выходе из редактора по
 команде <EXIT>.


 3.7.1. Запрет и разрешение записи в файл



 <ARG>w -<RETURN>
    - запретить изменение текущего файла;

 <ARG>w +<RETURN>
    - разрешить изменение (и запись, если она разрешена) ре-
    дактируемого файла.

         3.8. Перенос, уничтожение и вставка текста










__________________________

(*1)После выполнения <SAVE> без  параметров  для  повторения
   сеанса  в  случае  сбоя  необходимо восстановить исходное
   состояние файла из файла <имя>.bak, поскольку  изменилось
   исходное состояние редактируемых файлов.







                             21






 3.8.1. Приказы <OPEN> и <CLOSE>


    Приказ <OPEN> (раздвинуть)  позволяет  вставить  пробелы
 между колонками, строками или в середину группы строк.

 <OPEN>
    - перед текущей строкой вставляется пустая строка;

 <ARG>n<OPEN>
    - перед текущей строкой  вставляется  "n"  пустых  строк
    (где "n"-целое положительное число);

 <ARG><OPEN>
    - текущая строка делится на две части, начиная с текущей
    колонки;

 <ARG><указ.обл><OPEN>

 <ARG>$"имя"<OPEN>
    - в отмеченное курсором (или курсором  и  точкой  "имя")
    место вставляются пробелы (или пустые строки, если отме-
    чена группа строк целиком). Правила указания части файла
    с  помощью курсора подробно приведены в описании приказа
    <ARG>.

    Приказ <CLOSE> действует противоположно приказу  <OPEN>,
 убирая из файла соответствующую часть текста:

 <CLOSE>
    - уничтожить текущую строку;

 <ARG>n<CLOSE>
    - уничтожить "n" строк, начиная с текущей;

 <ARG><nCLOSE>
    - склеить текущую строку со следующей, причем  следующая
    строка приклеивается начиная с  текущей колонки;

 <ARG><указ.области><CLOSE>

 <ARG>$"имя"<CLOSE>
    - уничтожается указанный кусок текста либо группа  строк
    целиком.  Правила указания с помощью курсора приведены в
    разделе <ARG>.

    Текст, удаленный с помощью приказа <CLOSE>,  попадает  в
 конец  псевдо-файла "#" и может быть вставлен обратно (либо
 в другое  место) с помощью приказа:

 <ARG><PUT>
    - текст, убранный последним приказом <CLOSE>, вставляет-
    ся в текущее место файла.






                             22






    Псевдо-файл "#" можно просмотреть, введя приказ:

                         <ARG>#<USE>


 Для возврата в прежний файл служит приказ <USE>.

 <ARG>>"имя"<CLOSE>
    - текст, убранный последним приказом <CLOSE>,  запомина-
    ется в переменной "имя".

 3.8.2. Копирование текста (<PICK>, <PUT>)


    Для копирования текста используются два приказа.  Приказ
 <PICK>  (выбрать)  позволяет записать в буфер вставок кусок
 текста, который затем может быть  вставлен  в  произвольное
 место  по  приказу  <PUT>. Выбранный текст попадает в конец
 псевдо-файла "#" и может быть просмотрен (<ARG>#<USE>)  или
 выбран заново.

 <PICK>
    - выбрать для вставки текущую строку.

 <ARG>n<PICK>
    - выбрать n строк, начиная с текущей.

 <ARG><указ.области><PICK>

 <ARG>$"имя"<PICK>
    - выбрать указанный курсором участок файла (смотри  опи-
    сание <ARG>).

    Выбранный текст заносится в так называемый  "PICK"-буфер
 (буфер вставки).

 <ARG>>"имя"<PICK>
    - запомнить выбранный последним приказом <PICK> текст  в
    переменной "имя".

    Для вставки текста в файл используются приказы:

 <PUT>
    - выбранный ранее  текст  вставляется  в  текущее  место
    файла. При этом, если была выбрана группа строк целиком,
    происходит вставка строк, иначе текст вставляется в  се-
    редину имеющихся строк (которые для этого раздвигаются).

 <ARG><PUT>
    - работает аналогично <PUT>, но вместо <PICK>-буфера ис-
    пользуется  <CLOSE>-буфер, в котором запоминается текст,
    исключенный из файла последней командой <CLOSE>;







                             23






 <ARG>$"имя"<PUT>
    - текст из переменной $"имя" ("имя" - одна буква) встав-
    ляется в файл и становится текущим буфером вставки.

         3.9. Работа с окнами (<M-PORT> и <CH-PORT>)


    На экране терминала можно создавать новые "окна" и унич-
 тожать  старые.  Для  этого служит приказ <M-PORT> (создать
 окно). Новое окно создается в уже имеющемся  путем  деления
 его на две части. Если курсор находится в первой строке ок-
 на, то оно делится по вертикали; если курсор стоит в первой
 колонке  окна,  то деление происходит по горизонтали. В ос-
 тальных случаях выдается сообщение об ошибке. Примеры  при-
 ведены на рисунках 4 и 5.

                            Деление по горизонтали

                    До приказа          После приказа

                 ------------------ i-----------------
                 i                i i   старое       i
                 i                i i    окно        i
                 i*-курсор        i i----------------i
                 i   старое       i i   новое        i
                 i    окно        i i    окно        i
                 i                i i                i
                 i                i i                i
                 ------------------ ------------------

                                        Рис. 4

                              Деление по вертикали

                    До приказа          После приказа

                 ------------------ -------------------
                 i       *-курсор i i        ii       i
                 i                i i старое ii новое i
                 i                i i        ii       i
                 i   старое       i i окно   ii окно  i
                 i    окно        i i        ii       i
                 i                i i        ii       i
                 i                i i        ii       i
                 ------------------ -------------------

                                        Рис 5.


    Максимальное число окон на экране равно 10.









                             24






 <M-PORT>
    - создается новое  окно,  и  в  нем  высвечивается  файл
    /usr/lib/re.std.

 <ARG>имя<M-PORT>
    - Создается новое  окно,  и  в  нем  высвечивается  файл
    "имя".  В  том,  что  касается нового файла, приказ пол-
    ностью аналогичен приказу <USE>.

 <ARG><M-PORT>
    - уничтожить окно, созданное последним.

    Если один файл изображен сразу в нескольких окнах, изме-
 нения в нем будут высвечиваться одновременно во всех окнах.

    Для перехода из окна в окно служит приказ

                          <CH-PORT>
                       (сменить окно)


    Нескольких окон целесообразно использовать при сравнении
 файлов,  частичном  копировании  одного файла в другой, при
 работе с файлами диагностик об ошибках и в ряде других слу-
 чаев.

               3.10. Использование макрокоманд


    Последовательность приказов  редактора  вместе  с  любым
 текстом, если их приходится часто повторять, может быть за-
 помнена в "переменной" редактора RED. Для записи макроопре-
 деления служит приказ:

         <ARG>d "имя"<RETURN>

 ("имя" - одна буква). Редактор выдаст приглашение на ввод:

         mac:


    Введенный в ответ текст и команды редактора запишутся  в
 переменную  "имя".  Редактор отображает команды на экране в
 виде пары символов, их кодировка приведена в приложении  3.
 Признаком конца ввода является клавиша <del> (<забой>), для
 отмены ошибочных символов или команд  используется  команда
 <B-SPACE>.

    Для выполнения макрокоманды достаточно ввести:

         <line feed>$"имя"

 то есть последовательно нажать  клавиши  <line  feed>  (или






                             25






 <ПС>), "$" и малую латинскую букву, которой именуется пере-
 менная. Редактор подставляет содержимое  переменной  вместо
 ввода  с  терминала. Выполнение макро прерывается, если при
 выполнении записанной в макро операции поиска не найден ис-
 комый  текст. При необходимости можно переопределить какую-
 либо функциональную клавишу терминала как вызов  определен-
 ной макрокоманды.

              3.11. Переопределение клавиатуры


    В  редакторе  имеется  возможность   изменить   действие
 функциональных  и  управляющих  клавиш  терминала. При этом
 клавиша может обозначать как любую команду редактора, так и
 выполнение макрокоманды. Для этого служит приказ:

         <ARG>k<RETURN>


    Редактор запрашивает:

         "enter <new key><del>"

  Нажмите переопределяемую клавишу  и  затем  клавишу  <del>
 (<забой>).

         "enter <command> or <macro name>"

  Введите  команду,  имя  макропеременной  (малую  латинскую
 букву) или признак макропеременной "$". Если введена коман-
 ды редактора, то при нажатии переопределяемой клавиши будет
 вводиться  эта команда. Если введено имя переменной, значе-
 нием которой должна быть макрокоманда, то клавиша будет вы-
 зывать  эту  макрокоманду.  Если  был введен символ "$", то
 клавиша станет признаком макропеременной вместо  комбинации
 <line feed>$ (<перевод строки><символ "$">).

     3.12. Выполнение команд-фильтров   (приказ <EXEC>)


    Такие полезные операции над  текстами,  как  сортировка,
 выравнивание   параграфов  текста,  структуризация  текстов
 программ на "Си" и другие, выполняются командами операцион-
 ной  системы ДЕМОС. Редактор RED позволяет использовать та-
 кие команды для переработки части файла с  помощью  команды
 <EXEC>. Например, для контекстной замены "int" на "short" в
 очередных 10 строках файла служит приказ:

              <ARG>10l rpl "int" "short"<EXEC>


 После этого в  очередных  10  строках  произойдет  замена
 текста  "int"  на  "short",  которую  выполнит команда ОС






                             26






 ДЕМОС "rpl", написанная специально для RED.  Можно  вызы-
 вать  любые  команды,  которые  могут  использоваться как
 фильтр. Например:

 cb - улучшение читаемости программы на "Си",

 just- выравнивание параграфов текста,

 sort- сортировка

 Приказ <EXEC> может выполняться в одном из следующих фор-
 матов:

             <ARG><ч.п> <команда> <с.п.><EXEC>
             либо
             <ARG>-<ч.c.><команда> <с.п.><EXEC>
             либо
             <ARG><ч.с.>l <команда> <с.п.><EXEC>
             где <ч.п.> - число параграфов,
                 <ч.с.> - число строк,
                 <с.п.> - список параметров.

 Причем <число строк> или <список  параметров>  могут  от-
 сутствовать.

      - Первый (необязательный)  аргумент  определяет  число
        строк  либо  параграфов  за текущей строкой в файле,
        которые будут обрабатываться командой.  Параграфы  -
        это  группы  непустых  строк,  разделенные одной или
        несколькими пустыми строками. Целое  неотрицательное
        число указывает число параграфов; если число отрица-
        тельно или за ним следует буква "l" - оно  указывает
        число строк. Если первый аргумент опущен, то имеется
        в виду 1 параграф текста. Таким образом,  "-15"  или
        "15l" задают 15 строк текста, а "2" - 2 параграфа.

      - Второй аргумент - имя команды операционной  системы,
        за которым могут идти ее аргументы, разделенные про-
        белами. Для включения пробелов в аргумент можно  ис-
        пользовать кавычки ".

    Действие <EXEC> состоит в том, что вызывается  указанная
 команда  операционной  системы  с указаными параметрами; на
 стандартный ввод ей подаются заданные строки. Если  команда
 выполнилась  нормально, то указанные строки в файле заменя-
 ются на стандартный вывод команды. Старые строки помещаются
 в "CLOSE"-буфер.












                             27






 3.12.1. Контекстная замена (rpl)


    Программа "rpl" вызывается командой <EXEC> и требует два
 аргумента.  Она  заменяет в указанных строках все вхождения
 первого аргумента на второй аргумент. Если какой-либо аргу-
 мент содержит пробелы, он должен быть взят в кавычки. "rpl"
 распознает регулярные выражения в первом аргументе  по  тем
 же  правилам, что и редактор "ed" в контексте поиска [1], с
 тем отличием, что вместо символа "." используется  "@"  для
 обозначения одного произвольного символа.

 Например, команда:
 <ARG>100l rpl "^ *" " "<EXEC>

 исключит все группы пробелов в начале следующих 100  строк.
 Для  обозначения  самих  символов  "$",  "&", "@", "^", "*"
 перед ними необходимо ставить "\"(обратную черту).

 3.12.2. Примеры использования команды <EXEC>


    С помощью приказа <EXEC> можно вставить  в  любое  место
 файла группу файлов, набрав:

              <ARG>0 cat <список файлов><EXEC>


    Если при  вводе  программ  на  языке  "Си"  в  отдельных
 функциях  не  оставлять пустых строк, а сами функции разде-
 лять пустыми строками, то можно улучшить читаеmость  текста
 любой функции, подведя курсор к ее началу и набрав:

                        <ARG>cb<EXEC>


    Если в системе имеются команды just и fill  ("выровнять"
 или  "заполнить"),  то для выравнивания параграфа текста по
 левой и правой границам служит приказ:

                       <ARG>just<EXEC>


             3.13. Выход из редактора  (<EXIT>)


    Для того, чтобы окончить работу в RED, записав все изме-
 нения в архив, служит приказ:

                           <EXIT>


 Если нужно выйти из редактора, не записывая  изменения  в






                             28






 архив, необходимо набрать:

                        <ARG>a<EXIT>

 где "а" - строчная латинская буква "а".

    3.14. Прерывание выдачи. Аварийный выход из редактора


    В зависимости от описания терминала, редактор работает с
 ним  в  одном  из двух режимов: "грубом" ("raw") режиме или
 "одиночном"  ("cbreak").  Основным   является   "одиночный"
 режим, так как в "грубом" режиме система передает символы с
 терминала без обработки,  вследствие  чего  нельзя  вводить
 русские  буквы,   работать  с некоторыми мультиплексорами и
 многое другое (однако в некоторых случаях возможна работа в
 "грубом"  режиме,  например,  для  совместимости со старыми
 версиями редактора).
  Информация о режиме задается  при  описании  терминала.  В
 "одиночном" режиме операционная система интерпретирует сим-
 волы <ctrl>S, <ctrl>Q (приостановить  передачу,  продолжить
 передачу)  ,  <ctrl>N,  <ctrl>O (русский регистр, латинский
 регистр), а также символ "прерывание" (interrup) -  <ctrl>C
 (<ETX>).  Одиночное  нажатие символа "прерывание" прерывает
 вывод на экран или операцию контекстного поиска и переводит
 редактор  в режим ввода параметров. Двойное нажатие символа
 "прерывание" (одновременное нажатие <ctrl>C 2 раза) в  слу-
 чае,  если редактор не успел перейти в режим ввода парамет-
 ров, приводит к аварийному завершению работы без записи из-
 мененных  файлов. В режиме приема с клавиатуры символ "пре-
 рывание" интерпретируется как команда <ARG>. В режиме  пов-
 торения  прерванного  сеанса  нажатие  символа "прерывание"
 прерывает повторение и переводит редактор в режим  ввода  с
 терминала.

                4. ДИАГНОСТИЧЕСКИЕ СООБЩЕНИЯ


    Сообщения редактора высвечиваются в нижней строке  экра-
 на.  Они  делятся на сообщения о режимах работы и сообщения
 об ошибках. В зависимости от установленной версии редактора
 диагностики  выдаются на русском или английском языке. Ниже
 будут приводиться оба варианта диагностики.

                 Сообщения о режимах работы


 Ред:<имя>

 use:<имя>
    - идет чтение файла <имя>;








                             29






 Зап:<имя>

 save:<имя>
    - идет запись файла <имя>;

 +Поиск:<текст>

 -Поиск:<текст>

 +search:<текст>

 -search:<текст>
    - идет поиск текста <текст> вперед или назад;

 Выполнение.

 executing..
    - идет выполнение внешней команды;

 Режим вставки

 insertmode
    - установлен режим вставки;

 Указание курсором

 cursor defined
    - идет указание участка текста для приказов  <PICK>  или
    <CLOSE>;

 Создать(y/n)? имя

 Create (y/n)? имя
    - если вы действительно хотите создать новый файл <имя>,
    то введите "y";

 Строки указаны меткой

 lines defined by tag
    - предыдущим приказом указана часть строк файла (от кур-
    сора  до  запомненной в переменной метки), которая будет
    передана очередному приказу как параметр;

 Прямоугольник указан меткой

 square defined by tag
    - предыдущим приказом указана часть файла (от курсора до
    запомненной  в переменной метки), которая будет передана
    очередному приказу как параметр;

 Часть строки указана меткой








                             30






 columns defined by tag
    - предыдущим приказом указана часть строки  (от  курсора
    до  запомненной в переменной метки), которая будет пере-
    дана очередному приказу как параметр.


                    Сообщения об ошибках


 Аргумент должен быть числом

 argument must be numeric
    - аргумент приказа должен быть числовым;

 Аргумент должен быть положительным

 argument must be positive
    - аргумент должен быть положительным;

 Буфер вставок пуст

 nothing in the pick buffer
    - введен приказ <PUT>, но ни  разу  не  отмечался  текст
    приказом <PICK>;

 Close буфер пуст

 nothing in the close buffer
    - введен приказ <ARG><PUT>, но  не  разу  не  выполнялся
    приказ <CLOSE>;

 А что искать?

 nothing to search for
    - не задан образ для контекстного поиска;

 Текст не найден

 search key not found
    - образ для поиска не найден;

 Здесь нельзя создать окно

 can't put a window there
    - при создании нового окна курсор должен быть  в  первой
    строке окна или на первой колонке;

 Не могу создать столько окон

 can't make any more ports
    - превышено допустимое число окон (10);








                             31






 Слишком много файлов

 too many files...
    - превышено максимально допустимое число файлов (10);

 Вы не можете изменить этот файл

 you can't modify this file
    - файл нельзя изменять, так как запись в него запрещена.

    Имеется еще несколько редких  диагностик,  но  они,  как
 правило, самоочевидны.

    5. ПОСТАНОВКА РЕДАКТОРА RED. ПОДКЛЮЧЕНИЕ НОВЫХ ТИПОВ
                         ТЕРМИНАЛОВ


    Поскольку редактор RED сам по себе  ничего  не  знает  о
 терминалах,  на которых он работает, необходимую для работы
 информацию он получает от операционной системы. в ОС  ДЕМОС
 имеется  два  файла, в которых описаны терминалы конкретной
 установки (подробно см. 6 часть руководства программиста).

                      /etc/ttytype (5)


    Файл содержит по строке на каждый терминал, подключенный
 к конкретной вычислительной машине; строка имеет вид:

               <тип терминала> <имя терминала>


    Имя терминала содержит полное его имя в системе, из  ко-
 торого  исключено начало /dev/. Тип терминала - сокращенное
 название, под которым он описан в файле /etc/termcap.

    Программа tset служит для настройки системы на тип  тер-
 минала (в некоторых версиях настройка выполняется при входе
 автоматически). Тип терминала заносится в переменную   опи-
 сания оборудования TERM ("environment", (5)).

    Второй файл, /etc/termcap, содержит описания  свойств  и
 возможностей  различных  терминальных  устройств. Терминалы
 характеризуются набором функциональных возможностей, кодами
 команд и способом выполнения различных операций.

    Список терминалов,описание которых уже занесено в систе-
 му< приведен в приложении 2.

    Элементы файла termcap состоят из символьных полей, раз-
 деленных  символом ":"(двоеточие). Первый элемент указывает
 имена, под которыми терминал известен в системе; имена раз-
 делены   символом   (вертикальная   черта).   Как  правило,






                             32






 последнее имя является полным названием терминала, а преды-
 дущие  имена  -  его  сокращениями, которые используются, в
 частности, в файле /etc/ttytype.

    Для работы редактора необходимо,  чтобы  строка-описание
 данного  терминала  из  termcap  была  присвоена переменной
 "TERMCAP" из раздела описания оборудования  ("environment",
 (5)).   В  некоторых версиях это делает программа login при
 входе в систему, в противном случае (или если тип терминала
 заранее  не  известен), необходимо после регистрации выпол-
 нить команду

                     eval `tset -s[тип]`


 eval- встроенная команда интерпретатора "sh";

 tset- команда настройки терминала (см. "tset(1)");

 тип- необязательный параметр - тип вашего  терминала;  если
    он  не  указан, тип определяется из ttytype; если указан
    "?", то тип запрашиваеся с терминала в диалоге.

    Если переменная TERMCAP не определена,  редактор  выдает
 диагностику  и  кончает  работу. Подробную информацию можно
 найти в следующих разделах  оперативной документации по  ОС
 ДЕМОС:

                      environment (5),
                      tset        (1)
                      ttytype     (5)
                      termcap     (5)


    Описание каждого типа терминалов в файле termcap состоит
 из  ряда полей, разделенных символом ":". Если описание пе-
 реносится на новую строку, то в конце  предыдущей  ставится
 ":\" (:<обратный слэш>), и новая строка начинается с симво-
 ла ":".

    Все характеристики имеют двухсимвольные коды.

 Характеристика может иметь одну из трех форм записи:

 :<имя>: - характеристика описывает наличие  или  отсутствие
    какой-либо возможности (логический тип);

 :<имя>#<число>: - это численная  характеристика  (например,
    размер экрана);

 :<имя>=<задержка><строка>: - значением является строка сим-
    волов, задержка> может отсутствовать.







                             33






    В последнем случае за "=" следует необязательное  число,
 которое  указывает длительность задержки при выполнении ко-
 манды в миллисекундах; затем следует строка символов в  за-
 кодированной  форме. Элементы строки могут представляются в
 одной из четырех форм:

 1)   <обратный слэш><символ> - обозначает один из следующих
      символов, не представимых графически:

      \r     - код 015 (return);

      \n     - код 012 (line feed);

      \t     - код 011 (tab);

      \b     - код 010 (backspace);

      \f     - код 014.

 2)   \nnn, где "nnn" - восьмеричные цифры - символ с  кодом
      "nnn",

 3)   ^<буква> (<надчерк><буква>) - управляющий символ "бук-
      ва", например, "^C" обозначает символ "003".

 4)   <любой символ>, кроме ":", "\", "^" -  обозначает  сам
      себя.

 Символ "пусто" кодируется как \200.

    В таблице 1 приведены основные характеристики, использу-
 емые  редактором RED. Полное описание возможных характерис-
 тик имеется в документации по операционной  системе.  Более
 подробную информацию можно найти в документации по системе.

























                             34







                         таблица 1

  --------------------------------------------
  | n имя тип обя- только   значение         |
  |   хар     зат. для red  характеристики   |
  |------------------------------------------|
  | 1 co  чис   +  - число колонок в строке  |
  |   li  чис   +  - число строк на экране   |
  |------------------------------------------|
  | 2 am  лог   -  - терминал имеет автома-  |
  |                  тический перевод строк  |
  |------------------------------------------|
  | 3 bs  лог   -  - код 010 вызывает возврат|
  |                  на 1 позицию назад      |
  |   rt  стр   -  - возврат на начало строки|
  |   bc  стр   -  - код "курсор назад",     |
  |                  если не 010             |
  |   cm  стр   -  - адресация курсора *     |
  |   cl  стр   +  - очистка экрана          |
  |   do  стр   *  - курсор вниз             |
  |   up  стр   *  - курсор вверх            |
  |   nd  стр   *  - курсор вправо           |
  |   ho  стр   *  - курсор в начало экрана  |
  |------------------------------------------|
  | 3 is  стр   -  - инициализация терминала |
  |   fs  стр   -  + конец работы в редакторе|
  |                  возврат в начальное     |
  |                  состояние               |
  |   cu  стр   -  + код "светлый квадрат"   |
  |                  (как правило, \177.)    |
  |   nb  лог   -  + нет звукового сигнала   |
  --------------------------------------------


























                             35






                     Продолжение таб. 1

  --------------------------------------------
  | n имя тип обя- только  значение          |
  |   хар     зат. для red характеристики    |
  |------------------------------------------|
  | 4 UC  лог   -  - терминал имеет только   |
  |                  прописные буквы         |
  |   LC  лог   -  - терминал имеет прописные|
  |                  строчные буквы          |
  |   KI  лог   -  + терминал имеет русские и|
  |                  латинские  буквы        |
  |------------------------------------------|
  | 5 al  стр   -  - вставка пустой строки   |
  |   dl  стр   -  - исключение строки       |
  |   ic  стр   -  - вставить символ         |
  |   dc  стр   -  - исключить символ        |
  |   cd  стр   -  - очистить экран от курсор|
  |                  до конца                |
  |   ce  стр   -  - очистка конца строки    |
  |   sr  стр   -  - прокрутить текст вниз   |
  |   sf  стр   -  - прокрутить текст вверх  |
  |   ns  лог   -  - нет сдвижки текста      |
  |                  (нет roll)              |
  |------------------------------------------|
  | 6 rw  лог   -  +  работать в "raw"-режиме|
  |                   (для совместимости с 6 |
  |                   версией)               |
  |                   (это скорее указание ре|
  |                   дактору).              |
  |------------------------------------------|
  | 7 kd  стр   +  - код клавиши стрелка вниз|
  |   ku  стр   +  -  -- // -- стрелка вверх |
  |   kl  стр   +  -  -- // -- стрелка влево |
  |   kr  стр   +  -  -- // -- стрелка вправо|
  |   kh  стр   +  -  -- // -- "home"        |
  --------------------------------------------






















                             36







                     Продолжение таб. 1

  --------------------------------------------
  | n имя тип обя- только  значение          |
  |   хар     зат. для red характеристики    |
  |------------------------------------------|
  | 8 ko  стр   -  -  список (через запятую) |
  |                   тех управляющих клавиш,|
  |                   которые описаны для    |
  |                   данного терминала      |
  |                   (IL,DL,IC,DC,ER,k-,k.) |
  |------------------------------------------|
  | 9 IL  стр   -  +  Коды, вырабатываемые   |
  |   DL  стр   -  +  соответствующими       |
  |   IC  стр   -  +  клавишами и используе- |
  |   DC  стр   -  +  мые "red" для приказов:|
  |   ER  стр   -  +  <open>,<close>,<insert>|
  |                   <back space>, <arg>.   |
  |                   Не   имеет    значения,|
  |                   какую функцию выполняют|
  |                   они в автономном режиме|
  |------------------------------------------|
  |10 k.  стр   -  +  Коды, вырабатываемые   |
  |   k-  стр   -  +  дополнительной функцио-|
  |   k0  стр   -  -  нальной клавиатурой.   |
  |   k1                                     |
  |   ..  ...   .  .                         |
  |   k9  стр   -  -                         |
  |------------------------------------------|
  |11 tc=<имя>    означает, что остальные ха-|
  |               рактеристики   совпадают  с|
  |               характеристиками терминала |
  |               <имя>                      |
  |   <имя>@      отмена характеристики      |
  |               <имя>                      |
  --------------------------------------------


    Характеристики в таблице разбиты на 10 групп.

 Группа 1.
    Описывает размеры экрана терминала;

 Группа 2.
    Описывает способ управления курсором  на  экране.  Самый
    сложный  элемент  группы  - характеристика "cm" - описан
    ниже. Если у терминала нет возможности прямой  адресации
    курсора на экране, то для работы RED необходимы характе-
    ристики, помеченные символом "*" в графе "обязательный",
    в  противном  случае  редактор может обойтись и без них.
    Характеристика "am" означает, что при  достижении  конца
    строки   курсор   автоматически   переходит   на  начало






                             37






    следующей строки;

 Группа 3.
    Описывает инициализацию дисплея и дополнительные его ха-
    рактеристики.  "cu" - это код символа, используемого ре-
    дактором для маркировки положения курсора в  окне;  если
    он  не  указан,  используется  символ "@". Рекомендуется
    указывать "cu=\177", если только терминал умеет  отобра-
    жать этот код как светлый квадрат;

 Группа 4.
    Возможности  терминала  по  отображению  символов;  если
    "UC", то терминал должен работать в режиме "lcase";

 Группа 5.
    Дополнительные редактирующие возможности терминала;

 Группа 6.
    Флаг "rw"  вызывает  работу  редактора  с  терминалом  в
    ""прозрачном" режиме, при котором все управляющие симво-
    лы поступают в редактор, а при выводе система не переда-
    ет  символы на терминал без анализа. Режим может исполь-
    зоваться только в экзотических случаях для обхода ошибок
    системы при адресации курсора на некоторых терминалах. В
    этом режиме нельзя ввести русские буквы и прервать рабо-
    ту редактора.

 Группа 7.
    Коды, вырабатываемые основными управляющими клавишами,

 Группа 8.
    Содержит список имен характеристик клавиш, введенных до-
    полнительно  для редактора RED. Раздел введен только для
    совместимости со стандартным форматом termcap;

 Группа 9.
    Управляющие клавиши, используемые для команд:

    IL  - <OPEN>

    DL  - <CLOSE>

    IC  - <INSERT>

    DC  - <BACK SPACE>

    ER  - <ARG>

 Не имеет значения, что написано на  клавишах  в  действи-
 тельности.









                             38






 Группа 10.
    Коды, вырабатываемые дополнительной функциональной  кла-
    виатурой  с  надписями  "0-9" или "f0-f9". Действие этих
    клавиш в RED приведено в приложении;

 Группа 11.
    Позволяет описывать один терминал через другой, если они
    похожи. например:

              vt340:cm@:UC:KI:LC@:nb:tc=vdt52100c


                   5.1. Адресация курсора.


    Способ адресации курсора для данного терминала  описыва-
 ется характеристикой "cm" строчного типа,  в которой симво-
 лы смены режима интерпретации %x определены  так  же,   как
 для подпрограммы printf(3). Они заменяют собой кодироование
 номера текущей строки или позиции печати,  в то  время  как
 другие  символы  передаются  программе  без изменений. Если
 рассматривать строку "cm" как функцию,  то  аргументами  ее
 являются  номер  строки  и позиции,  на которые должен быть
 установлен курсор. Коды типа  "%" имеют следующий смысл:

 %d - то же,  что и для программы "printf",  причем "0"  со-
    ответствует первой строке или столбцу.

 %2 - эквивалентно %2d,

 %3 - эквивалентно %3d,

 %. - эквивалентно %c,

 %+x- сложить  величину  "x"  с  текущим  значением,   затем
    выдать ее по "%.";

 %r - обратный порядок номеров строки и  позиции;  вывод  не
    производится,

 %i - номера строки и позиции увеличиваются на 1,   то  есть
    исходной точкой считается "1",

 %% - дает один символ "%".

    Например,  для терминала "VDT-52100"  адресация  курсора
 описывается следующей строкой:

                         cm=3^a%.%.


    Терминалы, которые используют коды  вида  "%.",   должны
 иметь характеристики "bs" (или "bc") и "up",  то есть иметь






                             39






 возможность перемещать курсор назад на 1 позицию и вверх на
 одну  строку. Это необходимо,  так как редактор пытается не
 передавать при адресации курсора символы \T, \N, ^D  и  \r:
 система может изменить или уничтожить эти символы.

    В данном разделе очень кратко были изложены правила опи-
 сания  терминала в файле /etc/termcap. Обычно при появлении
 нового терминала бывает целесообразно для его описания  ис-
 пользовать  описание  какого-либо  другого терминала,  либо
 использовать краткое описание с параметром "tc=...".  Одна-
 ко,    скорее  всего  все  ваши  терминалы  уже  имеются  в
 /etc/termcap,  что избавит от необходимости  разбираться  в
 не очень простых правилах описания терминалов.


         ПРИЛОЖЕНИЕ 1. Справочная информация по RED


   Всего существует 32 команды редактора. В таблице 1 приве-
дена следующая информация о них:

1)   название команды в данной инструкции;

2)   как ввести команду с основной клавиатуры;

3)   как ввести команду с дополнительной цифровой клавиатуры
     (если  она есть и может генерировать управляющие после-
     довательности). (*1)

   Кодировка команд для наиболее распространенных терминалах
приведена  ниже.  Если  на  вашем  терминале  обозначения на
упрaвляющей клавиатуре не совпадают  с  приведеннными  ниже,
необходимо уточнить кодирование команд редактора у системных
программистов.













__________________________

(*1) Если управляющий код <УПР><символ> на терминале исполь-
     зуется управляющей клавиатурой, то команду можно ввести
     парой символов <ПС><символ>.







                             40






                         Таблица 1.

                   Команды редактора red

        _____________________________________________
        | название назначение   ввод с      ввод с |
        | приказа    приказа   основной     функц. |
        |                     клавиатуры клавиатуры|
        |__________________________________________|
        | LT    курсор влево   стрелка влево       |
        | RT    курсор вправо  стрелка вправо      |
        | UP    курсор вверх   стрелка вверх       |
        | DN    курсор вниз    стрелка вниз        |
        | RN    перевод строки <RETURN> или <ВК>   |
        | HOME    курсор в      <HOME>             |
        |         начало                           |
        | TAB    табуляция     <TAB> или <ГТ>      |
        | B-TAB  таб. назад       <УПР>B     <F.>  |
        | CH-TAB устaновка        <УПР>]   <F2><F5>|
        |        табуляции                         |
        |__________________________________________|
        | ESCAPE  признак        <ПС>,"@"    <F0>  |
        |         управляющего                     |
        |         символа                          |
        |__________________________________________|
        | +LINE   движение       <УПР>M   <F2><kd> |
        | -LINE   по строкам     <УПР>W   <F2><ku> |
        | +PAGE   движение по    <ПС>,"N"   <F7>   |
        | -PAGE   страницам      <УПР>Q   <F2><F7> |
        | GOTO    подвод к       <ПС>,"O"   <F4>   |
        | LEFT    окно влево     <ПС>,"S" <F2><kl> |
        | RIGHT   окно вправо    <УПР>A   <F2><kr> |
        |__________________________________________|
        | +SEARCH поиск вперед   <УПР>R     <F3>   |
        | -SEARCH поиск назад    <УПР>E   <F2><F3> |
        ____________________________________________























                             41






                     Продолжение таб.1.
 ____________________________________________
 | название назначение   ввод с      ввод с |
 | приказа    приказа   основной     функц. |
 |                     клавиатуры клавиатуры|
 |__________________________________________|
 | OPEN    раздвинуть     <УПР>K     <F8>   |
 | CLOSE   сдвинуть       <УПР>^   <F2><F8> |
 |__________________________________________|
 | PICK    отметить       <УПР>F     <F9>   |
 | PUT     поместить      <УПР>G   <F2><F9> |
 |__________________________________________|
 | M-PORT  создать окно   <ПС>,"J" <F2><F4> |
 |         видения                          |
 | CH-PORT сменить окно   <ПС>,"C" <F2><F0> |
 |         видения                          |
 |__________________________________________|
 | DEL-CH  исключить       <УПР>U    <F6>   |
 |         символ                           |
 | B-SPACE отменить        <УПР>]           |
 |         символ      или  <B-SPACE>       |
 |__________________________________________|
 | ARG     ввод            <ПС>," "  <F1>   |
 |         аргументов   или <ERASE>         |
 |__________________________________________|
 | INSERT  режим          <УПР>\     <F5>   |
 |         вставки      или <IL>            |
 |__________________________________________|
 | SAVE    записать       <ПС>,"V" <F2><F-> |
 | USE     редактировать  <УПР>D     <F->   |
 |         файл                             |
 |__________________________________________|
 | EXEC    выполнить      <ПС>,"P" <F2><F.> |
 |         команду                          |
 |         фильтр                           |
 |__________________________________________|
 | EXIT    выход         <ЗАБОЙ> или <DEL>  |
 --------------------------------------------



   Расположение  команд  редактора  red  на  клавиатуре  для
конкретных типов терминалов изображено на рисунках 1 - 5. На
схемах клавиатуры сверху написано название приказа,  который
исполняется  по данной клавише. Посередине - надпись на кла-
више. Снизу написано название приказа, который  исполняется,
если предварительно нажать клавишу "2".












                             42






  Команды для Электроника-15-ИЭ-0013
 ---------------------------
 |        |   &    |  USE  |  управ-
 |  i~~   |   I    |  V_|  |  ляющая
 |        | +LINE  |  SAVE |  клавиа-
 ---------------------------  тура
 |        |  HOME  |       |
 |  <--   |   &    |  -->  |
 |  LEFT  |        | RIGHT |
 ---------------------------
 | BSPACE |   I    |       |
 |  <-I   |   V    |  I->  |
 |        | -LINE  |       |
 ---------------------------
 | OPEN   | INSERT | CLOSE |
 |   =    |   ..   |   =   |
 |        |        |       |
 ---------------------------
 ----------------------------
 | +PAGE  |  OPEN  |  PICK  | допол-
 |  -7-   |  -8-   |  -9-   | нитель-
 | -PAGE  |  CLOSE |  PUT   | ная
 ---------------------------- цифровая
 |  GOTO  | INSERT | DCHAR  | клавиа-
 |  -4-   |  -5-   |  -6-   | тура
 | M-PORT | CH-TAB |        |
 ----------------------------
 |  ARG   | "УСТ"  | +SEARC |
 |  -1-   |  -2-   |  -3-   |
 |        | "ОТМ"  | -SEARC |
 ----------------------------
 |   ESCAPE        | B-TAB  |
 |     -0 -        |  -,-   |
 |   CH-PORT       | EXEC   |
 ----------------------------
  EXIT -"ЗБ"    TAB  - "ГТ"
               Рис. 1






















                             43






               Команды для VDT52100 и VT-340

 -------------------- ------------------
 | <CLOSE> | <OPEN> | |        | <ARG> |
 | "d l"   |  "i l" | |"return"|"erase"|
 |         |        | |        |       |
 -------------------- ------------------
 |<B-SPACE>|<INSERT>|
 | "d c"   |  "i c" |
 |         |        |
 --------------------
 |     <HOME>       |
 |    "h o m e"     |
 |                  |
 --------------------

   Ввод остальных команд:

 <+PAGE> - "LINEFEED"N  <+LINE> - "CTRL"+T
 <-PAGE> - "LINEFEED"Q  <-LINE> - "CTRL"+W
 <LEFT>  - "LINEFEED"S  <DEL-CH>-"CNTRL"+U
 <RIGHT> - "LINEFEED"A  <+SEARCH>-"CNTRL"+R
 <+GOTO> - "LINEFEED"O  <-SEARCH>-"CNTRL"+E
 <M-PORT>- "LINEFEED"J  <PICK> - "CNTRL"+F
 <CH-PORT>-"LINEFEED"C  <PUT>  - "CNTRL"+G
 <ESCAPE>-"LINEFEED"@   <EXEC> -"CNTRL"+P
 <CH-TAB>-"CNTRL"+]     <B-TAB> -"CNTRL"+B

 <SAVE> -"LINEFEED"V    <USE>  -"CNTRL"+D
 <EXIT>  -"DEL"

 знак "+" означает здесь одновременное
 нажатие.
                           Рис. 3

























                             44







                   Команды для ВТА 2000.3

 При нажатии на клавиши 0-9, ".",","
 необходимо одновременно
 нажать клавишу "УПР".

 -------------------------------------
 | ARG    | B-SPACE|  HOME  |    /   |
 | ***    | ***00  | &      |  ***   |
 | *00    |        | +----  |  /     |
 -------------------------------------
 | +PAGE  |  OPEN  |  PICK  |   &    |
 |  -7-   |  -8-   |  -9-   |   I    |
 | -PAGE  |  CLOSE |  PUT   | +LINE  |
 -------------------------------------
 |  GOTO  | INSERT | DCHAR  |   I    |
 |  -4-   |  -5-   |  -6-   |   V    |
 | M-PORT | CH-TAB |        | -LINE  |
 -------------------------------------
 |  ARG   | "уст"  | +SEARC |        |
 |  -1-   |  -2-   |  -3-   |  -->   |
 |        | "отм"  | -SEARC | RIGHT  |
 -------------------------------------
 |   ESCAPE        | B-TAB  |        |
 |     -0 -        |  -,-   |  <--   |
 |   CH-PORT       | EXEC   |  LEFT  |
 -------------------------------------

                           Рис. 4





























                             45







                   Команды для ВТА 2000.1

 При нажатии на клавиши 0-9, ".",","
 необходимо одновременно
 нажать клавишу "УПР".
 ------------------------------------------
 | ARG    |       |       |INSERT |B-SPACE|
 |"чистка | ***** | **::: |  ***> | <***  |
 | экрана"| ***:: |       |       |       |
 ------------------------------------------
 |  HOME  |       |       |   &   | OPEN  |
 | &      |       |       |   I   |   *   |
 | +----  |       |       | +LINE |   V   |
 ------------------------------------------
 | +PAGE  | OPEN  | PICK  |   I   | CLOSE |
 |  -7-   |  -8-  |  -9-  |   V   |   &   |
 | -PAGE  | CLOSE |  PUT  | -LINE |   *   |
 ------------------------------------------
 |  GOTO  |INSERT | DCHAR |       |       |
 |  -4-   |  -5-  |  -6-  | --->  |       |
 | M-PORT |CH-TAB |       | RIGHT |       |
 ------------------------------------------
 |  ARG   |"уст"  |+SEARC |       |       |
 |  -1-   |  -2-  |  -3-  | <---  |       |
 |        |"отм"  |-SEARC | LEFT  |       |
 ------------------------------------------
 |   ESCAPE       | B-TAB |       |       |
 |     -0 -       |  -,-  |       |       |
 |   CH-PORT      | EXEC  |       |       |
 ------------------------------------------
 любые клавиши, кроме "ар2" и -2- можно
 переопределять.

                           Рис. 4
























                             46







              МЕРА-7958,VDT-STATION,VDT-52129
          и другие терминалы, похожие на DEC/VT-52

             ----------------------------------
             | ARG    | OPEN  | CLOSE |   &   |
             | pf1    | pf2   | pf3   |   |   |
             |        |       |       | +LINE |
             ----------------------------------
             | +PAGE  | OPEN  | PICK  |   I   |
             |  -7-   |  -8-  |  -9-  |   V   |
             | -PAGE  | CLOSE |  PUT  | -LINE |
             ----------------------------------
             |  GOTO  |INSERT | DCHAR |       |
             |  -4-   |  -5-  |  -6-  | --->  |
             | M-PORT |CH-TAB |       | RIGHT |
             ----------------------------------
             |  ARG   |"уст"  |+SEARC |       |
             |  -1-   |  -2-  |  -3-  | <---  |
             |        |"отм"  |-SEARC | LEFT  |
             ----------------------------------
             |   ESCAPE      | B-TAB  | USE   |
             |     -0 -      |  -,-   | enter |
             |   CH-PORT     | EXEC   | SAVE  |
             -----------------------------------
             любые клавиши, кроме "ESCAPE" и -2-
                   можно  переопределять.

                           Рис. 5






























                             47






  ПРИЛОЖЕНИЕ 2. Список терминалов, внесенных в стандартный
                     файл /etc/termcap



el15- терминал "Электроника 15 ИЭ 0013";

el15m- терминал "Электроника 15 ИЭ 0013", в котором на плате
   клавиатуры  переключен  микропереключатель  в  "тестовый"
   режим;

vdtk- терминал VDT 52100 / 52106c фирмы "ВИДЕОТОН";

vt340- терминал "ВИДЕОТОН-340";

vdt- терминал VDT 52100 / 52106c, имеющий латинские  большие
   и малые буквы;

vta2t1- терминал ВТА 2000.1 и ВТА 2000.15;

vta2t2- терминал ВТА 2000.2;

vta2t3- семейство терминалов ВТА 2000.3;

vddsk- терминал VIDEOTON DATA DISPLAY STATION  фирмы  "Виде-
   отон";

elmc7401- терминал Электроника МС 7401;

mera7953- терминал MERA-7953;

vt100- терминал VT-100 фирмы DEC;

vt52- терминал VT-52 фирмы DEC.

   Точный список терминалов можно получить, распечатав  файл
/etc/termcap.

ПРИЛОЖЕНИЕ 3. Изображение команд редактора при вводе макро-
                        определения



















                             48






  lt      ^F    ch-tab  ^]
  rt      ^E    escape  ^@
  up      ^A    +line   ^T
  dn      ^B    -line   ^W
  rn      ^C    +page   ^N
  нome    ^D    -page   ^Q
  tab     ^G    goto    ^O
  b-tab   ^H    left    ^S
  right   ^Y    ch-port ^M
  +search ^R    del-ch  ^U
  -search ^X    b-space нет
  open    ^K    arg     ^_
  close   ^^    insert  ^(
  pick    ^I    save    ^V
  put     ^Z    use     ^L
  m-port  ^J    exec    ^P











































                             49






                         Содержание





1. ВВЕДЕНИЕ.............................................   2

2. ОБЩЕЕ ОПИСАНИЕ РЕДАКТОРА.............................   2

2.1. Основные принципы редактирования...................   2

2.2. Вызов редактора....................................   4

2.3. Использование клавиатуры и ввод команд редактора...   5

2.3.1. Отображение информации на экране видеотерминала..   6

2.3.2. Ввод информации с клавиатуры.....................   7

2.3.3. Ввод приказов в редактор RED ....................   8

2.4. Окна и редактируемые файлы.........................   9

2.5. Переменные и макрокоманды..........................  10

2.6. Что делать при сбое................................  11

3. ПРИКАЗЫ РЕДАКТОРА RED................................  11

3.1. Ввод параметров <ARG>..............................  12

3.2. Восстановление экрана..............................  14

3.3. Движение курсора внутри окна.......................  14

3.3.1. Клавиши со стрелкамми............................  14

3.3.2. Приказы <HOME> и <RETURN>........................  14

3.3.3. Табуляция (<tab>, <b-tab>, <set-tab>)............  15

3.4. Редактирование внутри строки.......................  15

3.4.1. Ввод текста. Режим вставки (<INSERT>)............  15

3.4.2. Уничтожение символов (<DEL-CH> и <BACKSPACE>)....  16

3.4.3. Ввод нетекстовых символов (<ESCAPE>).............  16

3.5. Перемещение по файлу...............................  17

3.5.1. Запоминание места в файле........................  17






                             50






3.5.2. Подвод к строке (<GO TO>)........................  17

3.5.3. Листование  файла  (<+PAGE>,  <-PAGE>,  <+LINE>,
       <-LINE>).........................................  17

3.5.4. Сдвиг окна вправо/влево .........................  18

3.6. Контекстный поиск (<+SEARCH>, <-SEARCH>) ..........  18

3.7. Чтение и запись файлов (<USE>, <SAVE>).............  19

3.7.1. Запрет и разрешение записи в файл................  20

3.8. Перенос, уничтожение и вставка текста..............  20

3.8.1. Приказы <OPEN> и <CLOSE>.........................  21

3.8.2. Копирование текста (<PICK>, <PUT>)...............  22

3.9. Работа с окнами (<M-PORT> и <CH-PORT>).............  23

3.10. Использование макрокоманд.........................  24

3.11. Переопределение клавиатуры........................  25

3.12. Выполнение команд-фильтров   (приказ <EXEC>)......  25

3.12.1. Контекстная замена (rpl)    ....................  27

3.12.2. Примеры использования команды <EXEC>      ......  27

3.13. Выход из редактора  (<EXIT>)......................  27

3.14. Прерывание выдачи. Аварийный выход  из  редактора
      ..................................................  28

4. ДИАГНОСТИЧЕСКИЕ СООБЩЕНИЯ ...........................  28

5. ПОСТАНОВКА РЕДАКТОРА RED.  ПОДКЛЮЧЕНИЕ  НОВЫХ  ТИПОВ
   ТЕРМИНАЛОВ...........................................  31

5.1. Адресация курсора..................................  38

ПРИЛОЖЕНИЕ 1. Справочная информация по RED..............  39

ПРИЛОЖЕНИЕ 2.  Список  терминалов,  внесенных  в  стан-
дартный файл /etc/termcap...............................  47

ПРИЛОЖЕНИЕ 3. Изображение команд  редактора  при  вводе
макроопределения........................................  47









