
VI(4)             ДЕМОС. Специальные файлы             VI(4)


ИИММЯЯ
        vvii - программный интерфейс терминала Электроники-85

ООППИИССААННИИЕЕ
        Программный интерфейс терминала Электроники-85  ими-
        тирует   обычный  дисплей,  имеющий  как  алфавитно-
        цифровой,  так  и  графический  режимы.   Управление
        интерфейсом  производится  при помощи универсального
        драйвера терминалов (см.  _t_t_y(4)).

ККЛЛААВВИИААТТУУРРАА ЛЛООГГИИЧЧЕЕССККООГГОО ТТЕЕРРММИИННААЛЛАА
        Основная клавиатура логического  терминала  располо-
        жена  в соответствии со стандартом "_Й_Ц_У_К_Е_Н". Следую-
        щие клавиши имеют специальное значение:

        Название        Назначение

        ВВРР              При нажатии  этой  клавиши  одновре-
                        менно с клавишей основной клавиатуры
                        будет   введен    символ    верхнего
                        регистра,  т.е. для букв - прописная
                        буква а для остальных клавиш -  сим-
                        вол обозначенный вверху.

        ФФККСС             Клавиша ФФККСС переключает режим фикса-
                        ции  верхнего  регистра, при котором
                        вводятся прописные (а  не  строчные)
                        буквы.  При  нажатой  клавише  ВВРР  в
                        режиме  фиксации  верхнего  регистра
                        будут   вводиться   строчные  буквы.
                        Включение режима фиксации  индициру-
                        ется светодиодом "ФФККСС".

        РРУУСС             переключает        русский/латинский
                        регистры.  Текущий регистр индициру-
                        ется светодиодом "ЛЛААТТ".

        ССУУ              При нажатии клавиши ССУУ вместе с бук-
                        вой  вводится  управляющий  символ с
                        кодами от 0 до 037 (восьм.).

        ККММПП             При нажатии клавиши ККММПП  уменьшается
                        скорость    плавного    роллирования
                        экрана. Увеличить скорость  плавного
                        роллирования можно при помощи однов-
                        ременного нажатия ККММПП и ВВРР.

        ССТТООПП ККААДДРР       Первое  нажатие  клавиши   ССТТООПП ККААДДРР
                        останавливает  вывод  на экран, пов-
                        торное - продолжает вывод.  Приоста-
                        новка  вывода  на экран индицируется
                        светодиодом "ССТТООПП ККААДДРР".

                        Одновременное нажатие  клавиш  "ССУУ",
                        "ВВРР"  и  "ССТТООПП ККААДДРР" восстанавливает
                        режимы  работы  драйвера   терминала
                        (это  нужно  если  режимы  работы не
                        были  восстановлены  программой  или


                            -1-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


                        случайно  на  терминал  был  выведен
                        объектный файл). Сброс режимов  соп-
                        ровождается звуковым сигналом.

        ППЕЕЧЧААТТЬЬ ККААДДРРАА    Нажатие клавиши ППЕЕЧЧААТТЬЬ ККААДДРРАА  приве-
                        дет  к печати битового образа экрана
                        на  АЦПУ.  По  умолчанию  печатается
                        негативное  изображение.  Для печати
                        позитивного изображения надо  однов-
                        ременно    нажать   клавиши   ВВРР   и
                        ППЕЕЧЧААТТЬЬ ККААДДРРАА.  На время чтения кадра
                        с  экрана вывод на экран приостанав-
                        ливается, что сигнализируется свето-
                        диодом    "ООЖЖИИДД".    Подробнее   см.
                        _p_s_c_r_e_e_n(8) и раздел  "Печать  кадра"
                        данной статьи.

        Ниже приведено расположение  клавиш  в  левой  части
        основной клавиатуры:

         ---------------
         |ООББРР TT| ; + |
         -------------------
            | ТТААББ | Й J |
         ---------------------
         | ССУУ  | ФФККСС | Ф F |
         -------------------------
            | ВВРР  | РРУУСС | Я Q |
            ------------------------
                        | ККММПП |  ппррооббеелл
                        --------------

        Расположение клавиш в правой части основной  клавиа-
        туры:

         ----------------------------
            | - = | TTЛЛ  | ТТПП  | ЗЗББ  |
          ---------------------------
               | : * | ВВШШ  | ВВКК  |
              --------------------
                  | . > |  ъ  |
              --------------------
               | / ? | -   | ВВРР  |
             ---------------------

        Следующие клавиши вырабатывают специальные коды  или
        кодовые  последовательности,  начинающиеся  символом
        EESSCC (033 восьм.).

        Клавиша                 Вырабатываемый код (восьм.)

        ВВШШ                      010
        ТТААББ                     011
        ВВВВООДД                    012
        ВВКК                      015
        ЗЗББ                      177
        ТТЛЛ                      ESC A
        ТТПП                      ESC B


                            -2-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


        ООББРР ТТ                   ESC C
        ППААУУЗЗАА                   ESC F
        УУССТТ РРЕЕЖЖИИММАА              ESC G
        ФФ55                      ESC H
        ППРРЕЕРРЫЫВВ                  ESC I
        ППРРООДДООЛЛЖЖ                 ESC J
        ООТТММЕЕНН                   ESC K
        ООССННООВВНН ККААДДРР             ESC L
        ВВЫЫХХООДД                   ESC M
        ФФ1111 (ААРР22)               ESC N
        ФФ1122 (ВВШШ)                ESC O
        ФФ1133 (ППСС)                ESC P
        ДДООПП ВВААРРИИААННТТ             ESC Q
        ППММ                      ESC R
        ИИССПП                     ESC S
        ФФ1177                     ESC T
        ФФ1188                     ESC U
        ФФ1199                     ESC V
        ФФ2200                     ESC W
        ННТТ                      ESC X
        ВВССТТ                     ESC Y
        УУДДААЛЛ                    ESC Z
        ВВЫЫББРР                    ESC @
        ППРРЕЕДД                    ESC 0
        ССЛЛЕЕДД                    ESC 1
        ППФФ11                     ESC 2
        ППФФ22                     ESC 3
        ППФФ33                     ESC 4
        ППФФ44                     ESC 5
        <<----                     ESC 6
        ---->>                     ESC 7
        ввнниизз                    ESC 8
        ввввееррхх                   ESC 9

        В нормальном режиме  работы  клавиши  дополнительной
        цифровой  клавиатуры  (она расположена в левой части
        клавиатуры) вырабатывают коды цифр  0-9  и  символов
        `.',  `,'  и `-'. Если программно включен режим аль-
        тернативной клавиатуры, эти клавиши будут  вырабаты-
        вать  кодовые  последовательности из символа с кодом
        035 (восьм.) и символа нажатой  клавиши.   Включение
        режима альтернативной клавиатуры индицируется свето-
        диодом "ККООММППООЗЗ".

ККООММААННДДЫЫ ЛЛООГГИИЧЧЕЕССККООГГОО ТТЕЕРРММИИННААЛЛАА
        Логический терминал Электроники-85  управляется  при
        помощи  символов с кодами 01-037 и управляющими пос-
        ледовательностями, начинающимися с символа  с  кодом
        033 (ESC).  Координаты отсчитываются с нуля от верх-
        него левого края экрана. Номер строки далее  обозна-
        чается как X, номер позиции - как Y.

ККООММААННДДЫЫ ААЛЛФФААВВИИТТННОО--ЦЦИИФФРРООВВООГГОО РРЕЕЖЖИИММАА
        Коды команд     Назначение

        0011              очистка  конца  экрана  от  текущего
                        положения маркера



                            -3-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


        0077              звуковой сигнал

        001100             возврат на шаг, перемещение  маркера
                        влево

        001111             табуляция по 8 позиций

        001122             перевод строки, перемещение  маркера
                        вниз;  при  выполнении  в  последней
                        строке экран сдвигается вверх

        001144             очистка экрана, маркер  устанавлива-
                        ется  в начальное положение, сбрасы-
                        вает режимы выделения

        001155             возврат в начало строки

        001166             русский регистр

        001177             латинский регистр

        002200             перемещение маркера вправо

        002222             перемещение   маркера   вверх;   при
                        выполнении  в  первой  строке  экран
                        сдвигается вниз

        002244             установка маркера  в  левый  верхний
                        угол экрана

        002255             очистка  конца  строки  от  текущего
                        положения маркера

        002266 _c_x _c_y       установка   маркера   в   координаты
                        (X,Y), координаты задаются символами
                        _c_x и _c_y с кодом 040 + координата

        003300 _x_0 _x_1       установка   диапазона   роллирования
                        (внутри окна) от строки _x_0 до строки
                        _x_1

        EESSCC 44           включить жирный шрифт

        EESSCC 55           выключить жирный жрифт

        EESSCC AA           включить курсив

        EESSCC BB           выключить курсив

        EESSCC CC           включить подчеркивание текста

        EESSCC DD           выключить подчеркивание текста

        EESSCC EE           включить выделение текста инверсией

        EESSCC FF           выключить выделение текста инверсией

        EESSCC GG           включить    альтернативный     режим


                            -4-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


                        клавиатуры

        EESSCC HH           выключить альтернативный режим  кла-
                        виатуры

        EESSCC II           включить плавное роллирование экрана

        EESSCC JJ           выключить    плавное    роллирование
                        экрана

        EESSCC KK           установить удвоенную высоту шрифта

        EESSCC LL           установить нормальную высоту шрифта

        EESSCC MM           включить  шрифтовой  набор  номер  2
                        (псевдографика)

        EESSCC NN           включить основной шрифтовой набор

        EESSCC OO _n         прочитать значение карты  цвета  для
                        цвета  _n (от 0 до 7), возвращает три
                        восьмеричные цифры -  для  компонент
                        R, G и B

        EESSCC PP _n _m_m_m     установить значение карты цветов для
                        цвета _n в _m_m_m (восьмеричное число из
                        трех цифр)

        EESSCC QQ           установить стандартную карту цветов

        EESSCC RR           восстановить  режимы  выделения   из
                        стека

        EESSCC SS           сохранить режимы выделения  в  стеке
                        (глубина стека - до 8)

        EESSCC TT           вставка пустой строки

        EESSCC UU           удаление текущей строки

        EESSCC vv           восстановить размер окна  до  целого
                        экрана

        EESSCC ww _x_0 _x_1 _y_0 _y_1
                        установить окно от  позиции  (_x_0,_y_0)
                        (верхний   левый  угол)  до  позиции
                        (_x_1,_y_1) (правый нижний угол) включи-
                        тельно

        EESSCC xx _n         установить цвет символов в  _n  (_n  -
                        цифра от 0 до 7)

        EESSCC yy _n         установить цвет фона в _n (_n -  цифра
                        от 0 до 7)

        EESSCC zz _c ...     загрузить битовую  карту  символа  _c
                        второго  шрифтового  набора; битовая
                        карта  задается  последовательностью


                            -5-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


                        из 20 символов (2 символа на строку,
                        каждый  символ   содержит   шестерку
                        битов  плюс  код 100 (восьм.), всего
                        10 строк по 12 пикселов).

        Команды EESSCC xx и EESSCC yy действуют также и в  графичес-
        ком режиме для установки цветов рисования примитивов
        и заполнений. Стандартно (для карты цветов по  умол-
        чанию) номера соответствуют следующим цветам:

        Номер   Цвет

        0       _ч_е_р_н_ы_й (_b_l_a_c_k)

        1       _с_и_н_и_й (_b_l_u_e)

        2       _з_е_л_е_н_ы_й (_g_r_e_e_n)

        3       _г_о_л_у_б_о_й (_c_y_a_n)

        4       _к_р_а_с_н_ы_й (_r_e_d)

        5       _м_а_л_и_н_о_в_ы_й (_m_a_g_e_n_t_a)

        6       _ж_е_л_т_ы_й (_y_e_l_l_o_w)

        7       _б_е_л_ы_й (_w_h_i_t_e)

ГГРРААФФИИЧЧЕЕССККИИЙЙ РРЕЕЖЖИИММ
        Координаты точек на экране отсчитываются от (0,0)  с
        левого  верхнего  угла экрана до (239,1023) в правом
        нижнем углу экрана. Здесь везде номер строки  растра
        обозначается как _x, а номер колонки - как _y.

        В графическом режиме координаты точек задаются трой-
        ками  символов  {_c_1,_c_2,_c_3}, вычисляемых по следующей
        программе:

        lloonngg l = ((lloonngg)_x)<<10) + _y;

        _c_1 = ((l>>12)&077) + '@';
        _c_2 = ((l>> 6)&077) + '@';
        _c_3 = ( l     &077) + '@';

        Радиусы дуг задаются аналогично, но  не  выполняется
        преобразование из (_x,_y) в l.

        Отношение шага сетки пикселов на экране терминала по
        вертикали и по горизонтали равно 5/2.  Радиусы зада-
        ются в единицах шагов по горизонтали.

        Все команды графического режима помеченные (*) уста-
        навливают новое значение текущих координат.

ККООММААННДДЫЫ ГГРРААФФИИЧЧЕЕССККООГГОО РРЕЕЖЖИИММАА
        Код команды     Назначение

        0022 _к_о_о_р_д        рисовать  окружность  с  центром   в


                            -6-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


                        текущей  позиции,  проходящюю  через
                        заданные координаты (*)

        0033 _к_о_о_р_д        включает  графический  режим  вывода
                        текста с заданных координат

        0055              выключает графический  режим  вывода
                        текста

        0066 _к_о_о_р_д        включает  заполнение   от   заданной
                        точки

        001133 _к_о_о_р_д       включает заполнение от  горизонталь-
                        ной  линии, проходящей через точку с
                        заданными координатами

        002211             выключает заполнение

        002233 _к_о_о_р_д       включает заполнение от  вертикальной
                        линии,   проходящей  через  точку  с
                        заданными координатами

        002277 _к_о_о_р_д       рисование дуги по часовой стрелке от
                        текущей    позиции    до   указанной
                        точки (*)

        003322 _к_о_о_р_д       рисование   дуги   против    часовой
                        стрелки  от  текущей позиции до ука-
                        занной точки (*)

        003344 _р_а_д_и_у_с      установка радиуса дуги, если  радиус
                        меньше  0 - то дуга будет рисоваться
                        по большей части окружности, иначе -
                        по  меньшей, если равен 0 - то будет
                        выбрана дуга с минимальным радиусом

        003355 _к_о_о_р_д       рисовать линию от текущей  точки  до
                        указанной (*)

        003366 _к_о_о_р_д       устанавливает   координаты   текущей
                        точки (*)

        003377 _к_о_о_р_д       рисует точку с  заданными  координа-
                        тами (*)

        EESSCC 00           рисование с нормальной яркостью

        EESSCC 11           рисование  с   половинной   яркостью
                        (через точку)

        EESSCC 22           режим заполнения 1 (белый фон)

        EESSCC 33           режим заполнения 2 (клетчатый фон)

ППЕЕРРЕЕККЛЛЮЮЧЧЕЕННИИЕЕ РРЕЕЖЖИИММООВВ ВВЫЫВВООДДАА ННАА ДДИИССППЛЛЕЕЙЙ
        Переключение режимов вывода на дисплей влияет как на
        алфавитный, так и на графический режимы.



                            -7-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


        Код команды     Назначение

        EESSCC aa           нет вывода

        EESSCC bb           "исключающее _и_л_и"

        EESSCC cc           нормальный режим

        EESSCC dd           инверсный режим

        EESSCC ee           наложение ("_и_л_и")

        EESSCC ff           стирание ("_н_е_т-_и")

        EESSCC gg           затирание черным

        EESSCC hh           затирание белым

        EESSCC ii           "исключающее _и_л_и" с  инвертированным
                        аргументом

        EESSCC jj           наложение инвертированного аргумента
                        ("_н_е_т-_и_л_и")

        EESSCC kk           конъюнкция ("_и")

        EESSCC XX           1 бит/пиксел (2 градации яркости)

        EESSCC YY           2 бита/пиксел (4 градации яркости)

        EESSCC ZZ           4 бита/пиксел (16 градаций яркости)

        EESSCC @@           выключено формирование  видеосигнала
                        (включается   по   любой  из  команд
                        EESSCC XX-ZZ).

ННЕЕППООССРРЕЕДДССТТВВЕЕННННЫЫЙЙ ДДООССТТУУПП КК ППААММЯЯТТИИ ЭЭККРРААННАА
        Память экрана видеоконтроллера Электроники-85  имеет
        объем  32 Кбайт  (в черно-белом варианте) и располо-
        жена в адресном пространстве начиная  с  физического
        адреса  016000000.   Каждой строке изображения соот-
        ветствуют 64 слова в памяти экрана, при  этом  млад-
        шему биту слова соответствует крайний левый, а стар-
        шему - крайний  правый  пикселы  из  соответствующих
        этому слову.

        Память экрана допускает все виды операций  с  опера-
        тивной памятью и может быть заказана при помощи сис-
        темного вызова pphhyyss, например:

        pphhyyss( 3, 01000, 0160000 )

        Этот системный вызов ставит в соответствие  логичес-
        ким  адресам  060000-0157776  программы пользователя
        всю  память  экрана  черно-белого  видеоконтроллера.
        Физический  доступ  к  экрану цветного видеомонитора
        пока не реализован.



                            -8-                      ДЕМОС/P


VI(4)             ДЕМОС. Специальные файлы             VI(4)


        В  отличие  от  обычного  использования   системного
        вызова  pphhyyss,  для доступа к памяти экрана не требу-
        ется полномочий суперпользователя.  Программа  поль-
        зователя  может  использовать  одновременно оба вида
        доступа - как через  программный  интерфейс,  так  и
        непосредственный  доступ к памяти экрана.  В интере-
        сах переносимости рекомендуется использовать по воз-
        можности только программный интерфейс.

ППЕЕЧЧААТТЬЬ ККААДДРРАА
        Для поддержки печати  кадра  в  драйвере  клавиатуры
        реализованы  две команды для системного вызова iiooccttll
        (см. файл /_u_s_r/_i_n_c_l_u_d_e/_s_y_s/_i_o_c_t_l._h).

        iiooccttll(_t_t_y, PPRR__SSCCRREEEENN, &_m_o_d_e)
                Этот вызов ждет, пока не будет  нажата  кла-
                виша  ППЕЕЧЧААТТЬЬ ККААДДРРАА, после чего приостанавли-
                вает вывод на экран  и  записывает  в  целую
                переменную  _m_o_d_e  режим  печати  кадра: если
                установлен бит PPRRSS__PPOOSSIITTIIVVEE то  нужно  печа-
                тать  позитивное  изображение, иначе - нега-
                тивное.  При срабатывании PPRR__SSCCRREEEENN  зажига-
                ется светодиод "ООЖЖИИДД".

        iiooccttll(_t_t_y, PPRR__SSDDOONNEE, NNUULLLL)
                Этот вызов нужно выполнить после  того,  как
                был  считан  образ  экрана  для  его печати.
                PPRR__SSDDOONNEE продолжает вывод на экран  и  гасит
                индикатор "ООЖЖИИДД" на клавиатуре.

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
        _p_h_y_s(2), _t_t_y(4), _k_l(4)

ЗЗААММЕЕЧЧААННИИЯЯ
        Драйвер  видеоконтроллера  не  поддерживает   (пока)
        непосредственный  доступ к памяти расширителя видео-
        контроллера для цветного монитора.

        Возможно изменение системы команд логического терми-
        нала  с  целью приближения ее к системе команд стан-
        дарта ANSI.



















                            -9-                      ДЕМОС/P

