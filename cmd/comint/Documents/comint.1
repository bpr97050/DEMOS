
COMINT(1)              ДЕМОС. Команды              COMINT(1)


ИИММЯЯ
        ccoommiinntt - экранный интерпретатор команд

ФФООРРММААТТ
        ccoommiinntt

ООППИИССААННИИЕЕ
        Программа ccoommiinntt предоставляет пользователю  возмож-
        ность в экранном диалоге редактировать файлы, транс-
        лировать и запускать программы, создавать,  удалять,
        переименовывать,  копировать файлы и т.п. Для особых
        случаев ccoommiinntt предоставляет  возможность  выполнить
        команду  sshh, однако позволяет задать файлы-параметры
        для этой команды в экранном диалоге.  Таким  образом
        comint  позволяет  90%  действий  выполнять нажатием
        одной-двух клавиш в экранном диалоге и только в  10%
        случаев подавать команды sshh.

ООССННООВВННЫЫЕЕ ППРРИИННЦЦИИППЫЫ РРААББООТТЫЫ
        Команда  ccoommiinntt  может  быть  запущена  как  обычная
        команда  без  параметров,  либо  вписана  в качестве
        командного языка данного пользователя.

        После запуска на экран выдается содержимое  текущего
        каталога  в  виде  таблички,  курсор останавливается
        около одного из файлов и ccoommiinntt ждет ввода.  Пользо-
        ватель  может  подвести  курсор  к нужному ему файлу
        (используя клавиши со стрелками) и  нажать  одну  из
        функциональных  клавиш. При этом ccoommiinntt будет выпол-
        нять действие с  этим  файлом,  которое  зависит  от
        нажатой клавиши и от типа файла (например, для текс-
        тового файла по нажатию клавиши <RETURN> будет запу-
        щен текстовый редактор).

        Действие основных клавиш ccoommiinntt:

        <RETURN>
                начало работы с объектом - запуск текстового
                редактора, вход в каталог, вход в библиотеку
                и др.

        <TAB>   запуск на  выполнение  -  запуск  программы,
                трансляция файлов, запуск mmaakkee и др.

        &       запуск процесса в фоновом режиме.

        @       запуск процесса в отладочном режиме

        <ERASE> уничтожение  объектов  -  стирает  предвари-
                тельно  помеченные  символом '-' файлы, уби-
                вает процессы и др.

        ?       получение информации об объекте - запуск llss,
                ppss.

                просмотр содержимого объекта -  вывод  файла
                ccaatt-ом, просмотр каталогов с помощью команды
                llss --aall и др.


                            -1-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


        <DEL>   отказ от предыдущего действия

        <CTRL/H>
                вывод инструкции

        Для того, чтобы посмотреть более подробную  инструк-
        цию,   запустите  ccoommiinntt  и  затем  нажмите  клавишу
        CTRL/H. При этом comint выведет инструкцию на экран.
        Выведенная  им  инструкция  будет содержать истинные
        названия клавиш Вашего терминала.

ННААССТТРРООЙЙККАА
        Команды, выполняемые ccoommiinntt в ответ на нажатие  кла-
        виш, задаются в файлах настройки. ccoommiinntt ищет и счи-
        тывает  три   файла   настройки:   /_u_s_r/_l_i_b/._c_o_m_i_n_t,
        домашний_каталог/._c_o_m_i_n_t  и текущий_каталог/._c_o_m_i_n_t.
        Первые два файла считываются при запуске,  третий  -
        при  каждом  входе в каталог. Это позволяет задавать
        индивидуальную реакцию ccoommiinntt для каждого  пользова-
        теля и в каждом каталоге (файлы из текущего и домаш-
        него     каталога     более     приоритетны,     чем
        /_u_s_r/_l_i_b/._c_o_m_i_n_t).

        Все три файла  настройки  имеют  одинаковый  формат.
        Каждого  строка  задает  реакцию  comint  на нажатие
        одной клавиши при выполнении определенных условий и,
        поэтому, имеет три поля, разделенных пробелами:
        код_клавиши  условие  действие
        Допускаются  пустые  строки  и  строки  комментария,
        начинающиеся с символа '*'.

ККООДД ККЛЛААВВИИШШИИ
        _К_о_д__к_л_а_в_и_ш_и задается в одном из следующих видов:

        -       мнемоника управляющего символа, например: rn
                lf re и др.  (см. список мнемоник в описании
                _d_p_i(3)).

        -       обозначение управляющего символа в  виде  'A
                -  CTRL/A

        -       символ '.', который  означает  использование
                того  же  кода  клавиши,  что и в предыдущей
                строке

        -       обычный графический символ клавиши

        -       экранированное  символом   "обратный   слэш"
                изображение  особых  символов,  например: \.
                \(пробел) \* и др.

        -       обозначение  внутренних  символов  ccoommiinntt  в
                виде _(буква), например: _a  _c

        Если символу должно предшествовать нажатие  клавиши-
        префикса,  то перед _к_о_д_о_м__к_л_а_в_и_ш_и ставится !, напри-
        мер: !lf !'A !#



                            -2-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


УУССЛЛООВВИИЕЕ
        Условие содержит от одного до пяти полей, записанных
        без  пробела, и обозначающих разные проверки свойств
        файла, около  имени  которого  нажата  клавиша.  Все
        поля,  кроме последнего, односимвольные. Если в поле
        стоит символ '_', то это  свойство  не  проверяется.
        Поля  идут  в фиксированном порядке, последние могут
        опускаться:

        1 -     наличие помеченных '*'-ой файлов

            y           есть помеченные файлы

            n           нет  помеченных файлов

            цифра       помечено ровно (цифра) файлов

        2 -             тип  файла.  Различаются   следующие
                        типы:

            s           source   текстовый файл

            o           object   файл формата _a._o_u_t

            a           archive  библиотека

            n           no       курсор стоит не около имени
                        файла

        3 -             режим  доступа  файла,  около  имени
                        которого стоит курсор

        4 -             первый символ файла

        5 -             шаблон имени файла. Можно  применять
                        метасимволы sshh

ДДЕЕЙЙССТТВВИИЕЕ
        Если  нажата  клавиша,  заданная  в  коде_клавиши  и
        выполняется  условие,  то comint запускает указанное
        действие. Действия записываются в  виде  строки  для
        sshh.   Перед  именем  команды  в  действии может быть
        помещен символ, управляющий показом этой команды  на
        экране:

        пусто   запустить команду невидимо

        '       показать запускаемую команду

        ,       не показывать команду, но выдать --- OK  ---
                после выполнения

        :       показать команду и выдать --- OK  ---  после
                ее выполнения

ММААККРРООППЕЕРРЕЕММЕЕННННЫЫЕЕ
        В действии могут быть использованы следующие  макро-
        переменные ccoommiinntt:


                            -3-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


        $@      имя файла, около которого стоит курсор

        $n      имя файла без суффикса

        $s      суффикс файла с точкой спереди

        $%      номер файла

        $*      список  имен  файлов,  помеченных  символами
                "*", ">", "<"

        $:      список имен помеченных файлов без имени пути
                по каталогам

        $#      список номеров файлов, помеченных  символами
                "*", ">", "<"

        $-      список имен файлов, помеченных символом "-"

        $c      имя текущего каталога

        $a      имя библиотеки, в которой находится comint

        $p      имя пути в библиотеке

        $C      имя каталога, в котором была пометка

        $A      имя библиотеки, в которой была пометка

        $P      имя  пути  в  библиотеке,  в  которой   была
                пометка

        $f      дополнительное   имя    (в    спец-командах,
                см.ниже)

        $g      второе дополнительное имя (в  спец-командах,
                см.ниже)

        $~      имя домашнего каталога пользователя

        $$      заменяется на одиночный $ перед вызовом sshh..

        Макропеременные,  обозначающие  компоненты  пути  по
        каталогам  ($c  $a  $p  ...)  могут быть соединены с
        помощью символа '/' - например, $c/$a/$p. При  этом,
        если  значение  такой переменной пусто, то '/' перед
        ней не ставится.

ППРРИИММЕЕРР
        Допустим, мы хотим, чтобы при  нажатии  клавиши  'f'
        около  имени  файла  ccoommiinntt сообщал нам его тип. Для
        этого  надо  поместить  в  файл  ._c_o_m_i_n_t   следующие
        строки:

         f  y      ,file $*
         . _a      echo библиотека
         . _c      echo каталог
         . _o1     echo выполняемый файл


                            -4-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


         . _o      echo объектный файл
         . _s1#    echo выполняемый файл на ccsshh
         . _s1     echo выполняемый файл на sshh
         . _s__*.c echo файл на C
         . _s__*.f echo файл на FORTRANе
         . _s__..  echo ссылка на вышележащий каталог
         . _s__Makefile echo файл для команды mmaakkee
         . _s      ,echo текстовый файл ; file $@
         . _echo данные

        Первая строка сработает, если мы пометили  несколько
        файлов  и нажали 'f' - вызовется команда ffiillee и ccoomm--
        iinntt остановится по ее завершении, прежде чем перевы-
        дать картинку. Строки проверяются в том порядке, как
        они написаны (см. распознавание файлов на ccsshh и sshh).

ВВННУУТТРРЕЕННННИИЕЕ ККООММААННДДЫЫ
        Кроме команд sh в поле действия могут быть  помещены
        коды встроенных команд ccoommiinntt.  Их вид:

        _буква[параметр]

        _aимя   показ информации о файле  'имя'  (встроенные
                llss + ssiizzee)

        _bимя   показ файла 'имя' (встроенный ccaatt)

        _cимя   переход в каталог 'имя'

        _d      конец работы

        _e      подъем по  дереву  каталогов  в  вышестоящий
                каталог

        _fкоманда
                вход в файл, считывая его каталог с  помощью
                'команды'

        _g      селекция имен файлов по нажатому символу

        _h      пометка файла символом '-'

        _iсимвол
                пометка файла (символ)'ом, а со второго раза
                '-'-ом

        _jсимв назван
                завести  новый  объект  (название)  командой
                _символ

        _zсообщение
                ошибка, выдает на экран 'сообщение' и гудок

        Встроенным командам не могут предшествовать  символы
        '  : и , .  В действии может быть только одна встро-
        енная команда.




                            -5-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


ППРРИИММЕЕРР
        Если мы хотим, чтобы по нажатию 'i' ccoommiinntt переходил
        в каталог /_u_s_r/_i_n_c_l_u_d_e, по нажатию 'm' - в /_u_s_r/_m_a_n,
        а по нажатию '%' около имени команды показывал руко-
        водство  по  ней,  то для этого необходимы следующие
        строки:

         i _ _c/usr/include
         m _ _c/usr/man
         % _ _b/usr/man/cat1/$@.1


        ВНУТРЕННИЕ СИМВОЛЫ

        В файле настройки заданы также команды,  выполняемые
        ccoommiinntt  для  внутренних нужд. В поле 1 у таких строк
        вместо реально существующего символа стоит код  т.н.
        внутреннего  символа.  В остальном формат этих строк
        такой же. Внутренние символы:

        _a      переименование объекта $@ в $f

        _b      удаление объекта $@

        _c      проверка  имени  файла  $@   на   ненужность
                (выполняется по CTRL/B)

        _d      показ текущих процессов пользователя

        _e      копирование объекта  $f  в  текущий  каталог
                после $@ под именем $g

        _f      перенос     объекта  $f  в  текущий  каталог
                после $@ под именем $g

        _n      инициализирующие действия при запуске ccoommiinntt

        _o      завершающие действия при выходе из ccoommiinntt

        _p      инициализирующие  действия  при  входе     в
                каталог снизу

        _s      инициализирующие  действия  при  входе     в
                каталог сверху

        _q      завершающие действия при выходе из  каталога
                вниз

        _t      завершающие действия при выходе из  каталога
                вверх

ППРРИИММЕЕРР
        Если требуется, чтобы при запуске  ccoommiinntt  пользова-
        телю  показывали  текущую  почту  и сообщения, а при
        выходе - стирали ненужные файлы,  то  надо  написать
        следующие строки в файле ._c_o_m_i_n_t домашнего каталога:




                            -6-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


        _n _    mail; msgs

        _o _    rm -f *.b core */*.b */core

ККООННССТТРРУУККЦЦИИИИ IIFF--TTHHEENN--EELLSSEE
        Иногда действия на нажатие клавиши  должно  зависеть
        от  более сложных условий, например от полного имени
        каталога. Для этого служит структурный оператор  IIFF--
        TTHHEENN--EELLSSEE, которые записываются в виде:

         (буква условие псевдо_действие    <- IF ... THEN
         группа строк
         +                                 <- ELSE
         группа строк
         )                                 <- ENDIF

        При этом в заголовке IIFF проверяется условие примени-
        тельно  к  макропеременной $(буква) . Формат условия
        такой же как и для  других  строк,  действие  должно
        быть  задано  фиктивное, например комментарий. Часть
        EELLSSEE  может  отсутствовать,  допускается   вложенное
        использование условных операторов.

        Возможна и другая форма заголовка IIFF:

        <символ

        при этом проверяется, что нажат (символ). Эта  форма
        применяется, для ускорения анализа файла ._c_o_m_i_n_t.

ППРРИИММЕЕРР
        Пусть мы хотим по  нажатию  буквы  'o'  стирать  все
        объектные   файлы   в  данном  каталоге.  Необходимы
        строки:

         (c _c7 проверяем доступ текущего каталога
            o _ rm -f *.o
          +
            o _ _zкаталог закрыт на запись
          )

ССИИННООННИИММЫЫ
        Иногда требуется, чтобы ccoommiinntt выполнял одни и те же
        действия  на  нажатие  нескольких  клавиш. Для этого
        можно определить синонимы клавиш,  поместив  в  файл
        настройки строку вида (формат фиксирован):

        5 = %

        Эта строка означает,  что  на  нажатие  клавиши  '5'
        должна быть такая же реакция, какая описана для кла-
        виши '%'.

УУППРРААВВЛЛЕЕННИИЕЕ ЗЗААГГООЛЛООВВККООММ ММЕЕННЮЮ
        Первой  строкой  файла  настройки  можно   поставить
        строку,  управляющую изображением на экране. Ее вид:
        /ключи .  Есть следующие ключи:



                            -7-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


        t       не показывать текущее время

        u       не показывать имя пользователя

        m       не показывать режим +

        p       не показывать асинхронные процессы

        n _с_т_р_о_к_а
                вместо  имени  каталога  показать  _с_т_р_о_к_у  в
                _с_т_р_о_к_е можно использовать $-макропеременные

ППРРИИММЕЕРР
        Если в файле ..ccoommiinntt будет:

         /tumpn Выберите редактируемый файл
         rn ns6 red $@
          . ns4 more $@
         + _   _z

        то пользователю будет предложен  список  файлов  для
        редактирования  и  просмотра  с помощью команд rreedd и
        mmoorree, причем сменить  режим  показа  (не  показывать
        ._b_a_k  и ._b файлы) он не сможет - команда '+' переоп-
        ределена (до тех пор, пока пользователь не выйдет из
        этого каталога).

РРААББООТТАА СС ФФААЙЙЛЛААММИИ--ККААТТААЛЛООГГААММИИ
        ccoommiinntt позволяет работать с файлами ДЕМОС,  имеющими
        каталоговую  структуру,  например  с  библиотеками в
        формате aarr.  Поскольку сам ccoommiinntt  ничего  не  знает
        про  структуры  таких файлов, то для выполнения всех
        своих действий с такими файлами-каталогами он  вызы-
        вает   команды   системы.  Прежде  всего  необходима
        команда, позволяющая считать список объектов данного
        файла. Так, если

        rn _a4 _far t $@

        то при нажатии клавиши <RETURN> около имени  библио-
        теки  ccoommiinntt  запустит  команду aarr tt ииммяя__ббииббллииооттееккии,
        считает каталог библиотеки и  покажет  его  в  своем
        стандартном формате.

        Первой строкой каталога файла можно поставить строку
        управления  заголовком,  начинающуюся  символом '/',
        например:

        rn _a4 _fecho /tumpn Это каталог библиотеки; ar t $@

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
        _s_h(1), _c_s_h(1), _v_s_h(1), _d_p_i(3)

ФФААЙЙЛЛЫЫ
        /_u_s_r/_l_i_b/._c_o_m_i_n_t     стандартный стартовый файл
        ~/._c_o_m_i_n_t            пользовательский стартовый
                             файл
        /_l_i_b/_t_t_y_s            каталог описаний терминалов


                            -8-                      ДЕМОС/P


COMINT(1)              ДЕМОС. Команды              COMINT(1)


        /_u_s_r/_m_i_n_i_h_e_l_p        каталог help-файлов

ЗЗААММЕЕЧЧААННИИЯЯ
        Клавиша  <DEL>  в  режиме  ввода  строки  обозначает
        отмену всей строки!























































                            -9-                      ДЕМОС/P

