
SEMOP(2)          ДЕМОС. Системные вызовы           SEMOP(2)


ИИММЯЯ
       sseemmoopp - открытие, закрытие, ожидание, проверка  сема-
       форов.

ФФООРРММААТТ
       #iinncclluuddee <_s_y_s/_t_y_p_e_s._h>
       #iinncclluuddee <_s_y_s/_i_p_c._h>
       #iinncclluuddee <_s_y_s/_s_e_m._h>

       sseemmoopp( _i_d, _o_p_s, _n_u_m )
       ssttrruucctt sseemmbbuuff *_o_p_s[];
       iinntt _i_d, _n_u_m;

ООППИИССААННИИЕЕ
       Системный вызов sseemmoopp выполняет изменение одного  или
       одновременное изменение нескольких семафоров в группе
       семафоров с идентификатором _i_d (см. sseemmggeett((22))))..

       Множество операций, которое надо выполнить,  задается
       массивом _o_p_s, состоящим из _n_u_m структур ssttrruucctt sseemmbbuuff
       следующего вида:

       ssttrruucctt sseemmbbuuff {
           sshhoorrtt sseemm__nnuumm;    /* номер семафора в группе */
           sshhoorrtt sseemm__oopp;     /* величина изменения семафора */
           sshhoorrtt sseemm__ffllgg;    /* флаги операции */
       };

       В этой структуре sseemm__nnuumm  указывает номер семафора  в
       группе, над которым надо выполнить операцию.

       Операция sseemm__oopp выполняется так:

       sseemm__oopp < 0
              Если _з_н_а_ч_е_н_и_е _с_е_м_а_ф_о_р_а + sseemm__oopp >= 0, то

                  к _з_н_а_ч_е_н_и_ю _с_е_м_а_ф_о_р_а прибавляется sseemm__oopp.

                  если _з_н_а_ч_е_н_и_е _с_е_м_а_ф_о_р_а теперь равно 0,  то
                  продолжить   процессы,  ожидавшие  события
                  "семафор равен нулю".

              Иначе остановиться и ожидать события  "семафор
              больше нуля".

       sseemm__oopp > 0
              Прибавить sseemm__oopp к _з_н_а_ч_е_н_и_ю _с_е_м_а_ф_о_р_а.  Продол-
              жить   процессы,  ожидавшие  события  "семафор
              больше нуля".

       sseemm__oopp ==== 00
              Если _з_н_а_ч_е_н_и_е _с_е_м_а_ф_о_р_а равно 0, то  ничего  не
              делать,  иначе  остановиться и ожидать события
              "семафор равен нулю".

       Если указан флаг IIPPCC__NNOOWWAAIITT, то остановки у  семафора
       не  происходит,  а системный вызов немедленно возвра-
       щает значение -1 и код ошибки EEAAGGAAIINN.


                            -1-                      ДЕМОС/P


SEMOP(2)          ДЕМОС. Системные вызовы           SEMOP(2)


       Если указан флаг SSEEMM__UUNNDDOO, то кроме прибавления вели-
       чины  sseemm__oopp  к  _з_н_а_ч_е_н_и_ю  _с_е_м_а_ф_о_р_а  происходит также
       запоминание величины изменения sseemm__oopp с обратным зна-
       ком.   Если процесс оканчивается, то запомненное зна-
       чение прибавляется к _з_н_а_ч_е_н_и_ю _с_е_м_а_ф_о_р_а.   Это  позво-
       ляет  избежать  тупиковых  ситуаций, связанных с тем,
       что процесс закрывает семафор  и  заканчивается,  так
       его и не открыв.

       Если хоть одна операция из  массива  _o_p_s  приводит  к
       ожиданию,  то  перед входом в ожидание восстанавлива-
       ются все значения  семафоров,  какими  они  были  при
       входе  в sseemmoopp; то есть процесс останавливается перед
       семафором, не изменив значений ни одного из указанных
       семафоров.

ВВООЗЗВВРРААЩЩААЕЕММООЕЕ ЗЗННААЧЧЕЕННИИЕЕ
       Системный вызов  возвращает  значение  последнего  из
       изменяемых  семафоров,  которое  было  у  него  перед
       выполнением операции.

ККООДДЫЫ ООШШИИББООКК
       При неудаче системный вызов возвращает значение -1  и
       код ошибки в переменной eerrrrnnoo:

       [[EENNOOEENNTT]]    Группы семафоров _i_d не существует.

       [[EEAACCCCEESS]]    Вы  не  имеете  права  изменять  семафоры
                   группы _i_d.

       [[EE22BBIIGG]]     Массив _o_p_s содержит слишком много  опера-
                   ций для одновременного выполнения.

       [[EEIINNVVAALL]]    Номер семафора вышел за пределы  размеров
                   группы семафоров.

       [[EERRAANNGGEE]]    После выполнения операции значение  сема-
                   фора  должно  стать  больше максимального
                   допустимого значения, либо во время  опе-
                   рации   запоминания  (SSEEMM__UUNNDDOO)  величина
                   изменения превышает максимально  допусти-
                   мое.

       [[EEAAGGAAIINN]]    Операция приведет к останову у  семафора.
                   (Указан флаг IIPPCC__NNOOWWAAIITT).

       [[EEIINNTTRR]]     Во  время  ожидания  у  семафора  процесс
                   получил сигнал.

       [[EEIIDDRRMM]]     Процесс снялся с семафора из-за того, что
                   группа,  содержавшая  этот  семафор, была
                   удалена.

ЗЗААММЕЕЧЧААННИИЯЯ
       Текущее состояние семафоров в системе и  номера  про-
       цессов,  ожидающих их открытия, можно узнать командой
       /_e_t_c/_i_p_c_s_t_a_t



                            -2-                      ДЕМОС/P


SEMOP(2)          ДЕМОС. Системные вызовы           SEMOP(2)


ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
       _s_e_m_g_e_t(2), _s_e_m_c_t_l(2), _i_p_c_s_t_a_t(8).


























































                            -3-                      ДЕМОС/P

